<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>jacpy&#39;s blog</title>
  <subtitle>enjoy mobile development</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://www.jacpy.com/"/>
  <updated>2016-12-11T08:41:18.000Z</updated>
  <id>http://www.jacpy.com/</id>
  
  <author>
    <name>jacpy</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>android Activity设置为SingleTop值时的生命周期在7.0以上系统中的变化</title>
    <link href="http://www.jacpy.com/2016/12/11/android-single-top-activity-lifecycle-changed-by-android-7.html"/>
    <id>http://www.jacpy.com/2016/12/11/android-single-top-activity-lifecycle-changed-by-android-7.html</id>
    <published>2016-12-11T04:13:15.000Z</published>
    <updated>2016-12-11T08:41:18.000Z</updated>
    
    <content type="html">&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;前几天在解决应用中一个问题，现象是在nexus 7.0以上系统的手机上创建群组会话时，消息发送超时。然后测试了一上，发现是必现的，而4.4系统的手机上却一切正常，于是一路分析了别人写的代码。最后找到原因并解决，于是就有了本文。&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;最后找到原因是在Android系统7.0以上，当把Activity的&lt;code&gt;launchMode&lt;/code&gt;属性值设置为&lt;code&gt;singleTop&lt;/code&gt;时，Activity的生命周期与以前的系统版本对应的生命周期有所不同。&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;我们都知道从Activity A启动了个Activity B，并在A中调用&lt;code&gt;finish()&lt;/code&gt;方法关闭A时，整个过程的生命周期的方法调用顺序是：先调用B的&lt;code&gt;onCreate()&lt;/code&gt;，然后再调用A的&lt;code&gt;onDestroy()&lt;/code&gt;。android系统这样做可能是为了提高系统的响应的速度，让应用以最快的速度看到UI发生变化，而不是从系统的角度考虑，先回收资源，资源回收OK了，再创建新的资源，所以就有了上面的这样生命周期方法的调用顺序。但在android 7.0系统以前有个例外情况：&lt;/p&gt;
&lt;p&gt;假如Activity A的&lt;code&gt;launchMode&lt;/code&gt;属性值被设置为&lt;code&gt;singleTop&lt;/code&gt;时，如果Activity A启动Activity B，在B中又启动了A，同时关闭B，如下图所示：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/2016/12/11/activity_single_top_flow.png&quot; alt=&quot;singleTop流程图&quot;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;此时A的生命周期方法的调用是：&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;先调用A的&lt;code&gt;onDestroy&lt;/code&gt;方法，用来关闭以前被启动的旧的Activity A，然后再调用在B中新startActivity的A的&lt;code&gt;onCreate&lt;/code&gt;方法。&lt;/p&gt;
&lt;p&gt;那么这里所说的生命周期与前面所说的情况不一样，就因为设置了一个&lt;code&gt;singleTop&lt;/code&gt;值。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;这个是android系统7.0以前的，那么7.0以后的系统上走上述同样的流程，生命周期的方法调用顺序是：&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;先调用新的Activity A的&lt;code&gt;onCreate&lt;/code&gt;方法，然后再调用旧A的&lt;code&gt;onDestroy&lt;/code&gt;方法。&lt;/p&gt;
&lt;p&gt;发现这里与没有设置&lt;code&gt;singleTop&lt;/code&gt;值时的生命周期一致，形成了统一。&lt;/p&gt;
&lt;p&gt;以上就是问题的原因，因为系统的差异造成的。由于使用的是google官方出的nexus系列手机测试，而又是使用原生的系统，可以认为是android官方系统这块的逻辑处理发生了变化。&lt;/p&gt;
&lt;p&gt;好了，下面就说实际遇到的场景：&lt;/p&gt;
&lt;p&gt;因为在Activity A中的&lt;code&gt;onDestroy&lt;/code&gt;方法中调用了关闭会话，并将一个全局的状态值修改为非法值，而在&lt;code&gt;onCreate&lt;/code&gt;方法中是重新初始化这个状态值。因为生命周期方法调用顺序在不同的系统上实现的差异，而导致这个状态值设置OK后，又被修改成非法值，从而使发送消息出去的报名格式发生变化，而服务器端在接收这个程序性错误后没有异常反馈，而终端则认为是服务器端没有响应而当作超时处理，所以发送失败。&lt;/p&gt;
&lt;p&gt;从上面现象可以看出系统后台设计人员并没有对这些程序性非业务逻辑性错误作出错误反馈，而后台有没有Log记录呢？&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;前几天在解决应用中一个问题，现象是在nexus 7.0以上系统的手机上创建群组会话时，消息发送超时。然后测试了一上，发现是必现的，而4.4系统的手机上却一切正常，于是一路分析了别人写的代码。最后找到原因并解决，于是就有了本文。&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;最后找到原因是在Android系统7.0以上，当把Activity的&lt;code&gt;launchMode&lt;/code&gt;属性值设置为&lt;code&gt;singleTop&lt;/code&gt;时，Activity的生命周期与以前的系统版本对应的生命周期有所不同。&lt;/p&gt;
    
    </summary>
    
      <category term="android" scheme="http://www.jacpy.com/categories/android/"/>
    
    
      <category term="singleTop android7.0" scheme="http://www.jacpy.com/tags/singleTop-android7-0/"/>
    
  </entry>
  
  <entry>
    <title>custom-bus-line-view-detail-1</title>
    <link href="http://www.jacpy.com/2016/09/21/custom-bus-line-view-detail-1.html"/>
    <id>http://www.jacpy.com/2016/09/21/custom-bus-line-view-detail-1.html</id>
    <published>2016-09-21T05:04:26.000Z</published>
    <updated>2016-09-21T05:26:25.000Z</updated>
    
    <content type="html">&lt;h1 id=&quot;自定义BusLineView详解（一）-滑动手势处理&quot;&gt;&lt;a href=&quot;#自定义BusLineView详解（一）-滑动手势处理&quot; class=&quot;headerlink&quot; title=&quot;自定义BusLineView详解（一）- 滑动手势处理&quot;&gt;&lt;/a&gt;自定义BusLineView详解（一）- 滑动手势处理&lt;/h1&gt;&lt;h2 id=&quot;处理Touch事件&quot;&gt;&lt;a href=&quot;#处理Touch事件&quot; class=&quot;headerlink&quot; title=&quot;处理Touch事件&quot;&gt;&lt;/a&gt;处理Touch事件&lt;/h2&gt;&lt;p&gt;首先从View类继承，重写两个与Touch事件想关的方法：&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;dispatchTouchEvent&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(MotionEvent event)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt;.dispatchTouchEvent(event);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onTouchEvent&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(MotionEvent event)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt;.onTouchEvent(event);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;dispatchTouchEvent&lt;/code&gt;方法与Touch事件分发有关，即从屏幕上获取到了触摸事件并交给当前View来处理。&lt;/p&gt;
&lt;h2 id=&quot;滚动处理&quot;&gt;&lt;a href=&quot;#滚动处理&quot; class=&quot;headerlink&quot; title=&quot;滚动处理&quot;&gt;&lt;/a&gt;滚动处理&lt;/h2&gt;</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;自定义BusLineView详解（一）-滑动手势处理&quot;&gt;&lt;a href=&quot;#自定义BusLineView详解（一）-滑动手势处理&quot; class=&quot;headerlink&quot; title=&quot;自定义BusLineView详解（一）- 滑动手势处理&quot;&gt;&lt;/a&gt;自定义BusL
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>公交站点线路自定义View分享</title>
    <link href="http://www.jacpy.com/2016/09/17/share-bus-line-custom-view.html"/>
    <id>http://www.jacpy.com/2016/09/17/share-bus-line-custom-view.html</id>
    <published>2016-09-17T04:23:19.000Z</published>
    <updated>2016-09-17T05:18:07.000Z</updated>
    
    <content type="html">&lt;p&gt;分享一个仿《车来了》公交线路提示的自定义组件。&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;先上效果图：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://github.com/jacpy/BusLine/blob/master/captures/bus_line.gif?raw=true&quot; alt=&quot;效果图&quot;&gt;&lt;/p&gt;
&lt;p&gt;github地址：&lt;a href=&quot;https://github.com/jacpy/BusLine&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/jacpy/BusLine&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;用工具分析了官方的实现，使用的是google提供的v4包中的RecycleView来实现的，所以会看到各种View叠加。&lt;/p&gt;
&lt;p&gt;上面View实现方式是使用自定义View的方式，使用了绘图方面的API和滑动手势控制，还实现了站点点击事件控制。所以整个就一个View，也就不存在View回收的问题。另外要注意在View中调用次数比较频繁的方法中要注意性能，比如onDraw()方法中，刷的次数非常频繁，特别是在滑动的时候，而这个方法又是一个关键的处理方法，计算特别多，所以这里要注意，否则方法运行时间超过16ms就会造成卡顿。&lt;/p&gt;
&lt;p&gt;经过测试：在2013年的机型MOTO G XT1032机子上运行，同时刷新96个公交站点数据，onDraw()方法耗时平均7ms左右。&lt;/p&gt;
&lt;p&gt;后面会写文章分析下实现方式及遇到的坑和解决方案。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;分享一个仿《车来了》公交线路提示的自定义组件。&lt;/p&gt;
    
    </summary>
    
      <category term="android view" scheme="http://www.jacpy.com/categories/android-view/"/>
    
    
      <category term="自定义View 公交线路" scheme="http://www.jacpy.com/tags/%E8%87%AA%E5%AE%9A%E4%B9%89View-%E5%85%AC%E4%BA%A4%E7%BA%BF%E8%B7%AF/"/>
    
  </entry>
  
  <entry>
    <title>React Native iOS集成说明</title>
    <link href="http://www.jacpy.com/2016/09/06/react-native-ios-integrated.html"/>
    <id>http://www.jacpy.com/2016/09/06/react-native-ios-integrated.html</id>
    <published>2016-09-06T03:52:54.000Z</published>
    <updated>2016-09-06T08:57:47.000Z</updated>
    
    <content type="html">&lt;blockquote&gt;
&lt;p&gt;本文主要是记录将React Native集成到现有项目的说明步骤及中间遇到的一些坑的记录。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h3 id=&quot;一、模板生成&quot;&gt;&lt;a href=&quot;#一、模板生成&quot; class=&quot;headerlink&quot; title=&quot;一、模板生成&quot;&gt;&lt;/a&gt;一、模板生成&lt;/h3&gt;&lt;p&gt;假如你的PC已经安装好了React Native环境，只需要在命令行执行以下命令即可以生成模板：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;$react-native init RNDemo&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;其中RNDemo是项目名称，这里确保与你现在的项目名称一致。&lt;/p&gt;
&lt;p&gt;生成好模板后，cd到RNDemo/ios/目录中，将该目录下的所有文件都删除，然后将现有项目所有文件复制到ios目录中。&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&quot;二、环境配置&quot;&gt;&lt;a href=&quot;#二、环境配置&quot; class=&quot;headerlink&quot; title=&quot;二、环境配置&quot;&gt;&lt;/a&gt;二、环境配置&lt;/h3&gt;&lt;h4 id=&quot;2-1-添加项目库&quot;&gt;&lt;a href=&quot;#2-1-添加项目库&quot; class=&quot;headerlink&quot; title=&quot;2.1 添加项目库&quot;&gt;&lt;/a&gt;2.1 添加项目库&lt;/h4&gt;&lt;p&gt;使用xcode打开现有项目，将以下库添加到项目中：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;react-native/React/React.xcodeproj&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;react-native/Libraries/Network/RCTNetwork.xcodeproj&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;react-native/Libraries/Text/RCTText.xcodeproj&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;react-native/Libraries/WebSocket/RCTWebSocket.xcodeproj&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;react-native/Libraries/ActionSheetIOS/RCTActionSheet.xcodeproj&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;添加方法如下图所示：&lt;br&gt;&lt;img src=&quot;/images/2016/09/06/xcode_config_project_library.png&quot; alt=&quot;xcode配置&quot;&gt;&lt;br&gt;在弹出的窗口的右下角点击&lt;code&gt;Add Others...&lt;/code&gt;按钮，在弹出的窗口中选择上面相应目录下的&lt;code&gt;.xcodeproj&lt;/code&gt;文件，将项目库包含进来。操作完成后，需要再次点击&lt;code&gt;+&lt;/code&gt;号，将静态库都包含进来，如下图所示：&lt;br&gt;&lt;img src=&quot;/images/2016/09/06/xcode_config_add_static_library.png&quot; alt=&quot;xcode添加静态库&quot;&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h4 id=&quot;2-2-添加配置&quot;&gt;&lt;a href=&quot;#2-2-添加配置&quot; class=&quot;headerlink&quot; title=&quot;2.2 添加配置&quot;&gt;&lt;/a&gt;2.2 添加配置&lt;/h4&gt;&lt;blockquote&gt;
&lt;p&gt;如下配置如果已经配置过，则可以跳过。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;1）搜索头文件地址配置&lt;br&gt;头文件搜索路径配置如下所示：&lt;br&gt;&lt;img src=&quot;/images/2016/09/06/xcode_config_head_search_path.png&quot; alt=&quot;头文件目录搜索路径配置&quot;&gt;&lt;br&gt;双击&lt;code&gt;Header Search Path&lt;/code&gt;右侧区域即可显示弹出的层，双击其中的行，则进入编辑模式。&lt;/p&gt;
&lt;p&gt;其中&lt;code&gt;$(SRCROOT)&lt;/code&gt;为当前项目路径，可以理解为&lt;code&gt;.xcodeproj&lt;/code&gt;文件所在的路径，&lt;code&gt;../node_modules&lt;/code&gt;表示的是与ios同级目录的node_moduels目录。&lt;/p&gt;
&lt;p&gt;2）启用HTTP配置&lt;br&gt;点击项目中的info.plist文件（注意是项目的plist文件，不是Tests中的），在右侧增加如下图所示的配置：&lt;br&gt;&lt;img src=&quot;/images/2016/09/06/plist_add_http.png&quot; alt=&quot;启用HTTP配置&quot;&gt;&lt;br&gt;如果没有启用，运行时会提示如下错误：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;App Transport Security has blocked a cleartext HTTP (http://) resource load since it is insecure. &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Temporary exceptions can be configured via your app&amp;apos;s Info.plist file.&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;3）支持C++编译&lt;br&gt;添加C++编译支持如下图所示：&lt;br&gt;&lt;img src=&quot;/images/2016/09/06/other_linker_flag_support_cpp.png&quot; alt=&quot;添加C++编译支持&quot;&gt;&lt;br&gt;添加方法与上面添加&lt;code&gt;Header Search Path&lt;/code&gt;类似。&lt;br&gt;如果没有添加&lt;code&gt;-lc++&lt;/code&gt;，编译会报如下所示错误：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;Undefined symbols for architecture x86_64:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &amp;quot;std::terminate()&amp;quot;, referenced from:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      ___clang_call_terminate in libReact.a(RCTJSCExecutor.o)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &amp;quot;operator delete[](void*)&amp;quot;, referenced from:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      -[RCTJSCExecutor dealloc] in libReact.a(RCTJSCExecutor.o)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      executeRandomAccessModule(RCTJSCExecutor*, unsigned int, unsigned long, unsigned long) in libReact.a(RCTJSCExecutor.o)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      readRAMBundle(std::__1::unique_ptr&amp;lt;__sFILE, int (*)(__sFILE*)&amp;gt;, RandomAccessBundleData&amp;amp;) in libReact.a(RCTJSCExecutor.o)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      RandomAccessBundleData::~RandomAccessBundleData() in libReact.a(RCTJSCExecutor.o)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &amp;quot;operator new[](unsigned long)&amp;quot;, referenced from:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      executeRandomAccessModule(RCTJSCExecutor*, unsigned int, unsigned long, unsigned long) in libReact.a(RCTJSCExecutor.o)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      readRAMBundle(std::__1::unique_ptr&amp;lt;__sFILE, int (*)(__sFILE*)&amp;gt;, RandomAccessBundleData&amp;amp;) in libReact.a(RCTJSCExecutor.o)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &amp;quot;___cxa_begin_catch&amp;quot;, referenced from:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      ___clang_call_terminate in libReact.a(RCTJSCExecutor.o)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &amp;quot;___gxx_personality_v0&amp;quot;, referenced from:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      -[RCTJavaScriptContext initWithJSContext:onThread:] in libReact.a(RCTJSCExecutor.o)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      -[RCTJavaScriptContext init] in libReact.a(RCTJSCExecutor.o)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      -[RCTJavaScriptContext invalidate] in libReact.a(RCTJSCExecutor.o)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      RCTNSErrorFromJSError(RCTJSCWrapper*, OpaqueJSContext const*, OpaqueJSValue const*) in libReact.a(RCTJSCExecutor.o)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      +[RCTJSCExecutor runRunLoopThread] in libReact.a(RCTJSCExecutor.o)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      -[RCTJSCExecutor init] in libReact.a(RCTJSCExecutor.o)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      -[RCTJSCExecutor initWithUseCustomJSCLibrary:] in libReact.a(RCTJSCExecutor.o)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      ...&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;ld: symbol(s) not found for architecture x86_64&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;clang: error: linker command failed with exit code 1 (use -v to see invocation)&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;如果没有添加&lt;code&gt;-ObjC&lt;/code&gt;，运行则会报如下错误：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;[error][tid:com.facebook.react.JavaScript] Native module cannot be null.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[error][tid:com.facebook.react.JavaScript] Requiring module &amp;quot;193&amp;quot;, name:InitializeJavaScriptAppEngine, which threw an exception.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;RNDemo[13446:1473714] -[RCTRootView reactTag]: unrecognized selector sent to instance 0x7ff670d14de0&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;RNDemo[13446:1473714] *** Terminating app due to uncaught exception &amp;apos;NSInvalidArgumentException&amp;apos;, reason: &amp;apos;-[RCTRootView reactTag]: unrecognized selector sent to instance 0x7ff670d14de0&amp;apos;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;可能提示的module Id不一样，导致的原因是一样的。在这里卡了很久:(。&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&quot;三、增加代码&quot;&gt;&lt;a href=&quot;#三、增加代码&quot; class=&quot;headerlink&quot; title=&quot;三、增加代码&quot;&gt;&lt;/a&gt;三、增加代码&lt;/h3&gt;&lt;p&gt;在已有项目的启动配置位置，如&lt;code&gt;AppDelegate.m&lt;/code&gt;文件中增加上面没有删除的&lt;code&gt;AppDelegate.m&lt;/code&gt;文件中的代码，如下所示：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;#import &amp;quot;AppDelegate.h&amp;quot;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;#import &amp;quot;RCTBundleURLProvider.h&amp;quot;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;#import &amp;quot;RCTRootView.h&amp;quot;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;@implementation AppDelegate&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  NSURL *jsCodeLocation;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  [[RCTBundleURLProvider sharedSettings] setDefaults];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  jsCodeLocation = [[RCTBundleURLProvider sharedSettings] jsBundleURLForBundleRoot:@&amp;quot;index.ios&amp;quot; fallbackResource:nil];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  RCTRootView *rootView = [[RCTRootView alloc] initWithBundleURL:jsCodeLocation&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                                                      moduleName:@&amp;quot;RNDemo&amp;quot;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                                               initialProperties:nil&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                                                   launchOptions:launchOptions];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  rootView.backgroundColor = [[UIColor alloc] initWithRed:1.0f green:1.0f blue:1.0f alpha:1];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  self.window = [[UIWindow alloc] initWithFrame:[UIScreen mainScreen].bounds];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  UIViewController *rootViewController = [UIViewController new];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  rootViewController.view = rootView;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  self.window.rootViewController = rootViewController;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  [self.window makeKeyAndVisible];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  return YES;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;@end&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;注意：&lt;code&gt;index.ios&lt;/code&gt;就是模板在RNDemo目录下生成的&lt;code&gt;index.ios.js&lt;/code&gt;文件，moduleName&lt;code&gt;RNDemo&lt;/code&gt;是项目的名称，这里要替换成刚开始初始化模板的命令的项目名称。&lt;/p&gt;
&lt;p&gt;最后，按cmd + r后，会自动启动React Native服务，可以看到运行效果。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;本文主要是记录将React Native集成到现有项目的说明步骤及中间遇到的一些坑的记录。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="iOS" scheme="http://www.jacpy.com/categories/iOS/"/>
    
    
      <category term="React Native" scheme="http://www.jacpy.com/tags/React-Native/"/>
    
  </entry>
  
  <entry>
    <title>chrome浏览器启动android应用并传递参数</title>
    <link href="http://www.jacpy.com/2016/06/27/chrome_open_android_app.html"/>
    <id>http://www.jacpy.com/2016/06/27/chrome_open_android_app.html</id>
    <published>2016-06-27T04:56:08.000Z</published>
    <updated>2016-06-27T05:05:31.000Z</updated>
    
    <content type="html">&lt;blockquote&gt;
&lt;p&gt;本文档主要介绍如何在android手机的chrome浏览器中点击一个链接，然后启动一个本地的App，并使用App中的具有浏览器功能的界面，如包信有WebView的Activity，打开一个链接。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h2 id=&quot;协议介绍&quot;&gt;&lt;a href=&quot;#协议介绍&quot; class=&quot;headerlink&quot; title=&quot;协议介绍&quot;&gt;&lt;/a&gt;协议介绍&lt;/h2&gt;&lt;p&gt;这种打开方式要浏览器支持这种协议，比如chrome浏览器，然后浏览器根据协议来做指定的事情。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;协议格式如下所示：&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;intent:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   HOST/URI-path // Optional host &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   #Intent; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      package=[string]; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      action=[string]; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      category=[string]; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      component=[string]; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      scheme=[string]; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   end;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;参数说明：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;HOST: 对应intent-filter标签中的data标签中的&lt;code&gt;android:host&lt;/code&gt;属性说明；&lt;/li&gt;
&lt;li&gt;scheme：对应intent-filter标签中的data标签中的&lt;code&gt;android:scheme&lt;/code&gt;属性说明；&lt;/li&gt;
&lt;li&gt;package：打开的App的包名；&lt;/li&gt;
&lt;li&gt;action：接收处理这个Intent的action，可选；&lt;/li&gt;
&lt;li&gt;category：接收处理Intnet的category，可选；&lt;/li&gt;
&lt;li&gt;component：接收处理Intent的component，可选；&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;上面这些参数对应java的代码如下所示：&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;Intent intent = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Intent(&lt;span class=&quot;string&quot;&gt;&quot;action&quot;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;intent.setData(Uri.pase(&lt;span class=&quot;string&quot;&gt;&quot;host&quot;&lt;/span&gt;));&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;intent.addCategory(&lt;span class=&quot;string&quot;&gt;&quot;category&quot;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;intent.setComponent(&lt;span class=&quot;string&quot;&gt;&quot;component&quot;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;context.startActivity(intent);&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;上面部分参数对应的在AndroidManifest.xml文件中的Activity中的配置如下所示：&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;activity&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;android:name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;com.jacpy.app.ui.WebViewActivity&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;android:screenOrientation&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;portrait&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;android:theme&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;@android:style/Theme.Black.NoTitleBar&quot;&lt;/span&gt;&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;intent-filter&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;action&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;android:name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;android.intent.action.VIEW&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;category&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;android:name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;android.intent.category.DEFAULT&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;category&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;android:name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;android.intent.category.BROWSABLE&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;android:scheme&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;scheme&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;android:host&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;host&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;intent-filter&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;activity&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;上面的这些说明只是说要如何利用这些参数启动这个指定的App的Activity，接下来是说明如何将一些参数信息传递给这个指定的Activity，由这个Activity来处理一些指定的操作，比如打开一个链接。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;传递的参数类型在java中有9种类型，分别是String(S)、Boolean(B)、Byte(b)、Character(c)、Double(d)、Float(f)、Integer(i)、Long(l)、Short(s)，注意后面括号中的字母及大小写。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;比如要传一个字符串，可以写成如下所示：&lt;/p&gt;
&lt;p&gt;S.url=&lt;a href=&quot;http://www.baidu.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.baidu.com&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;键是&lt;code&gt;url&lt;/code&gt;，值是&lt;code&gt;http://www.baidu.com&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;传一个int值，可以写成这样：&lt;/p&gt;
&lt;p&gt;i.age=30&lt;/p&gt;
&lt;p&gt;键是&lt;code&gt;age&lt;/code&gt;，值是&lt;code&gt;30&lt;/code&gt;。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;这种传递方式对应的java代码如下所示：&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;intent.putExtra(&lt;span class=&quot;string&quot;&gt;&quot;url&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;http://www.baidu.com&quot;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;intnet.putExtra(&lt;span class=&quot;string&quot;&gt;&quot;age&quot;&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;30&lt;/span&gt;);&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;注意：&lt;code&gt;S.browser_fallback_url&lt;/code&gt;是chrome保留的内容，在手机安装了chrome 25以上版本，启动了包含有&lt;code&gt;S.browser_fallback_url&lt;/code&gt;信息的协议，如果手机中没有安装指定包名的App那么，就会跳转到&lt;code&gt;S.browser_fallback_url&lt;/code&gt;指定的链接，这个链接一般是放App的下载地址。在实际测试是，手机中不能安装Google Play，否则会打开google Play。而不会执行&lt;code&gt;S.browser_fallback_url&lt;/code&gt;这个跳转。&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;实现&quot;&gt;&lt;a href=&quot;#实现&quot; class=&quot;headerlink&quot; title=&quot;实现&quot;&gt;&lt;/a&gt;实现&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;按照上面的协议说明可以自定义协议，如下所示：&lt;br&gt;intent://msp.url/#Intent;scheme=msp;package=com.jacpy.app;S.browser_fallback_url=&lt;a href=&quot;http://www.taobao.com/app/download;S.url=http://www.baidu.com;S.title=chrome启动应用测试;end&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.taobao.com/app/download;S.url=http://www.baidu.com;S.title=chrome启动应用测试;end&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;上面示例协议中，如果手机上没有安装包名为&lt;code&gt;com.jacpy.app&lt;/code&gt;的应用，并且手机上没有安装google play，那么最后页面会跳转到&lt;code&gt;http://wwww.taobao.com/app/download&lt;/code&gt;。&lt;br&gt;协议可以写在a标签中，如：&lt;/p&gt;
&lt;figure class=&quot;highlight html&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;href&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;\&lt;/span&gt;&quot;&lt;span class=&quot;attr&quot;&gt;intent:&lt;/span&gt;//&lt;span class=&quot;attr&quot;&gt;msp.url&lt;/span&gt;/#&lt;span class=&quot;attr&quot;&gt;Intent&lt;/span&gt;;&lt;span class=&quot;attr&quot;&gt;scheme&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;msp;package&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;com.jacpy.app;S.browser_fallback_url&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;http://www.taobao.com/app/download;S.url&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;http://www.baidu.com;S.title&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;chrome启动应用测试;end\&lt;/span&gt;&quot;&amp;gt;&lt;/span&gt;chrome启动应用测试&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;a&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;对应的Activity配置代码如下所示：&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;manifest&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;xmlns:android&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;http://schemas.android.com/apk/res/android&quot;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;package&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;com.jacpy.app&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;android:versionCode&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;0&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;android:versionName&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;2.0.0.0&quot;&lt;/span&gt; &amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;application&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;android:name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;com.jacpy.app.app.App&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;android:allowBackup&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;true&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;android:icon&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;@drawable/logo&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;android:label&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;@string/app_name&quot;&lt;/span&gt; &amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;activity&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;attr&quot;&gt;android:name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;com.jacpy.app.ui.WebViewActivity&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;attr&quot;&gt;android:screenOrientation&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;portrait&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;attr&quot;&gt;android:theme&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;@android:style/Theme.Black.NoTitleBar&quot;&lt;/span&gt;&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;intent-filter&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;action&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;android:name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;android.intent.action.VIEW&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;category&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;android:name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;android.intent.category.DEFAULT&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;category&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;android:name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;android.intent.category.BROWSABLE&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;android:scheme&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;msp&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;android:host&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;msp.url&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;intent-filter&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;activity&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;application&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;manifest&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;这里要注意，如果当前应用已经启动，点击跳转链接，浏览器是不会启动相应的界面打开链接，可以对当前Activity设置&lt;code&gt;android:launchMode=&amp;quot;singleInstance&amp;quot;&lt;/code&gt;试试。&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;协议传递数据解析处理&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;package&lt;/span&gt; com.jacpy.app.ui;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;WebViewActivity&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Activity&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onCreate&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Bundle b)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt;.onCreate(b);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        Intent data = getIntent();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        String url = data.getStringExtra(&lt;span class=&quot;string&quot;&gt;&quot;url&quot;&lt;/span&gt;); &lt;span class=&quot;comment&quot;&gt;// 要跳转的链接&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        String title = data.getStringExtra(&lt;span class=&quot;string&quot;&gt;&quot;title&quot;&lt;/span&gt;); &lt;span class=&quot;comment&quot;&gt;// 标题内容&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;最后，这种通过浏览器打开应用的方式只在实现了类似机制的浏览器上使用，如chrome浏览器。通过测试其他如QQ浏览器的6.6版本也支持该方式，但UC、Opera、海豚浏览器均不支持该操作。&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;参考：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;1.&lt;a href=&quot;https://developer.chrome.com/multidevice/android/intents&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://developer.chrome.com/multidevice/android/intents&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;2.&lt;a href=&quot;http://drops.wooyun.org/papers/2893&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://drops.wooyun.org/papers/2893&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;– EOF –&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;本文档主要介绍如何在android手机的chrome浏览器中点击一个链接，然后启动一个本地的App，并使用App中的具有浏览器功能的界面，如包信有WebView的Activity，打开一个链接。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
    
    </summary>
    
      <category term="android" scheme="http://www.jacpy.com/categories/android/"/>
    
    
      <category term="chrome" scheme="http://www.jacpy.com/tags/chrome/"/>
    
  </entry>
  
  <entry>
    <title>android应用开发常见的坑</title>
    <link href="http://www.jacpy.com/2016/05/10/android-app-develop-familiar-trap.html"/>
    <id>http://www.jacpy.com/2016/05/10/android-app-develop-familiar-trap.html</id>
    <published>2016-05-10T13:32:56.000Z</published>
    <updated>2016-07-15T06:44:15.000Z</updated>
    
    <content type="html">&lt;p&gt;android应用开发过程中，总会遇到一些坑。当遇到这些坑马上反应过来时，会很快解决。而没有反应过来时，估计是要折腾半天，下面记录一些这样的坑，防止自己遗忘再犯同样的错，自己以后再遇到类似的问题，也在这里记录下来。&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;1.&lt;code&gt;context.startActivityForResult(intent, int)&lt;/code&gt;第二个参数int值要为大于0，并且不大于65535。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;如果为不大于0，则不会回调到Activity的&lt;code&gt;onActivityResult()&lt;/code&gt;方法。如果大于&lt;code&gt;65535&lt;/code&gt;为提示如下错误：&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;Caused by: java.lang.IllegalArgumentException: Can only use lower 16 bits for requestCode&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;at android.support.v4.app.FragmentActivity.startActivityForResult(FragmentActivity.java:840)&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;出现这种问题只有在Activity继承了&lt;code&gt;android.support.v4.app.FragmentActivity&lt;/code&gt;的时候才会出现，而继承&lt;code&gt;android.app.Activity&lt;/code&gt;的时候不会。所以为了不必要的麻烦，还是建议使用requestCode的值要不大于&lt;code&gt;65535&lt;/code&gt;。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;因为在同一个Activity和其中的Fragment都使用到了&lt;code&gt;onActivityResult()&lt;/code&gt;方法，为了避免Activity的requestCode不与Fragment冲突，所以就使用了&lt;code&gt;Integer.MAX_VALUE&lt;/code&gt;，结果就导致了上面的异常。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;2.重写Activity的&lt;code&gt;onActivityResult()&lt;/code&gt;方法时，如果在该Activity中使用了Fragment，并且重写了Fragment的&lt;code&gt;onActivityResult()&lt;/code&gt;方法，此时一定要在Activity的&lt;code&gt;onActivityResult()&lt;/code&gt;方法中调用&lt;code&gt;super.onActivityResult()&lt;/code&gt;，否则Fragment的&lt;code&gt;onActivityResult()&lt;/code&gt;方法不会被回调。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;3.在Fragment切换的布局中使用了FrameLayout后，为了能切换更快，使用了&lt;code&gt;FragmentTransaction.hide()&lt;/code&gt;方法，将已经初始化的Fragment隐藏，而没有使用&lt;code&gt;FragmentTransaction.replace()&lt;/code&gt;方法。其中有一个Fragment中的布局文件中的内容没有超过一屏，在点击底部空白的地方，会点击之前已经隐藏的Fragment的中布局文件中的组件。归根倒底是由于FrameLayout布局影响的，最快的解决办法是在内容没有超过一屏的布局文件中的根ViewGroup中设置`android:clickable=”false”即可，当然网上说重写onTouchEvent()方法，可以试试。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;4.在给ListView调用&lt;code&gt;addHeader()&lt;/code&gt;方法添加头部时，一定要在调用&lt;code&gt;setAdapter()&lt;/code&gt;方法之前调用，否则会出现如下错误， 这个错误&lt;code&gt;在android 4.4以前的系统会存在，4.4及以后的系统中修复了这个问题&lt;/code&gt;。错误提示也很明显：&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;java.lang.IllegalStateException: Cannot add header view to list -- setAdapter has already been called.at android.widget.ListView.addHeaderView(ListView.java:&lt;span class=&quot;number&quot;&gt;261&lt;/span&gt;)at android.widget.ListView.addHeaderView(ListView.java:&lt;span class=&quot;number&quot;&gt;290&lt;/span&gt;)&lt;span class=&quot;comment&quot;&gt;// ...&lt;/span&gt;at android.support.v4.app.Fragment.performCreateView(Fragment.java:&lt;span class=&quot;number&quot;&gt;1962&lt;/span&gt;)at android.support.v4.app.FragmentManagerImpl.moveToState(FragmentManager.java:&lt;span class=&quot;number&quot;&gt;1026&lt;/span&gt;)at android.support.v4.app.FragmentManagerImpl.moveToState(FragmentManager.java:&lt;span class=&quot;number&quot;&gt;1207&lt;/span&gt;)at android.support.v4.app.BackStackRecord.run(BackStackRecord.java:&lt;span class=&quot;number&quot;&gt;738&lt;/span&gt;)at android.support.v4.app.FragmentManagerImpl.execPendingActions(FragmentManager.java:&lt;span class=&quot;number&quot;&gt;1572&lt;/span&gt;)at android.support.v4.app.FragmentManagerImpl$&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;.run(FragmentManager.java:&lt;span class=&quot;number&quot;&gt;493&lt;/span&gt;)at android.os.Handler.handleCallback(Handler.java:&lt;span class=&quot;number&quot;&gt;800&lt;/span&gt;)&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;android应用开发过程中，总会遇到一些坑。当遇到这些坑马上反应过来时，会很快解决。而没有反应过来时，估计是要折腾半天，下面记录一些这样的坑，防止自己遗忘再犯同样的错，自己以后再遇到类似的问题，也在这里记录下来。&lt;/p&gt;
    
    </summary>
    
      <category term="android" scheme="http://www.jacpy.com/categories/android/"/>
    
    
      <category term="android" scheme="http://www.jacpy.com/tags/android/"/>
    
  </entry>
  
  <entry>
    <title>微信支付返回code为-1解决方法之一</title>
    <link href="http://www.jacpy.com/2016/05/10/weixin-pay-return-code-1.html"/>
    <id>http://www.jacpy.com/2016/05/10/weixin-pay-return-code-1.html</id>
    <published>2016-05-10T13:28:57.000Z</published>
    <updated>2016-05-10T13:38:50.000Z</updated>
    
    <content type="html">&lt;p&gt;这两天在集成微信支付的功能，先是客户在插件中集成支付功能，后来发现回调不起来，于是将支付功能集成到了主应用，然后暴露接口给插件使用。费劲几个小时的折腾，于是乎就有下文。&lt;/p&gt;
&lt;p&gt;我们先来看下官网对于code为-1的说明（官网说明地址&lt;a href=&quot;http://kf.qq.com/faq/140225MveaUz150413VNj6nm.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;点这里&lt;/a&gt;）：&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;开放平台配置的报名和应用签名是否一致：（android）；确认是否使用正式的keystore打包apk并安装调试；（android）；提交订单部分需要在服务器端完成。&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;先请仔细阅读，你遇到的问题就在这段描述中。其中注意，中间还错别字&lt;code&gt;报名&lt;/code&gt;应为&lt;code&gt;包名&lt;/code&gt;（鹅厂果然不一样）。&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;下面开始说说事情的经过和结果：&lt;/p&gt;
&lt;p&gt;公司这里给客户做了一个应用，客户那边的业务扩展使用插件的方式开发，然后集成到主应用中来。由于客户业务中需要支付功能，而且在插件中支付功能不能正常运行，于是我这边就将插件中的支付集成到主应用中，然后给接口让插件调用。使用这种方式集成完后，我测试了一遍，支付宝支付OK，微信支付也OK。于是跟他们说集成好了，可以用了。&lt;/p&gt;
&lt;p&gt;客户那边测试使用的时候反馈，微信支付只能支付成功一次，第二次就不行了。于是乎，我这边也试了下，果然，第二次支付不成功。一看输出的LOG，回调的code返回-1。&lt;/p&gt;
&lt;p&gt;为了解决这个问题与客户进行了沟通，客户说是我集成的问题，说他们写了一个测试的demo，连续支付两次都没有问题。好吧，我自己寻找问题的解决方案。我很确信自己的代码集成没有问题，那部分代码也是来自客户写的支付代码。如果客户写的代码有问题，就不可能连续支付两次都OK。&lt;/p&gt;
&lt;p&gt;于是找到了前面的官方回调后返回code为-1的说明，当时也只是读了一遍，没深究，因为我觉得问题原因都不是，毕竟还支付成功过一次。&lt;/p&gt;
&lt;p&gt;最后去反编译看微信SDK的代码，支寻找为什么会返回-1，突然看到代码里面的getPackageName()时，想到了包名，回忆起之前集成微信第三方登录时绑定的包名和签名信息，突然大悟，是不是和包名有关？客户测试的demo包名和主应用的包名是不一样的。于是跟客户沟通，看了一下支付微信的后台配置，叫对方把包名改成主应用的包名，结果测试，支付两次OK。好吧，问题找到了。&lt;/p&gt;
&lt;p&gt;回想起整个问题解决过程，还是插件开发惹的祸。但中间种种不正常让人生疑，如果包名不对，为什么还能在清除应用缓存之后能支付成功？其实当时我应该就要反应过来，有谁会做成这种支付的时候还要清除缓存就能支付成功的？体验做成这样，还叫BAT？可能这个提示是官方支付demo里面的提示，集成的时候直接拿过来用了吧。&lt;/p&gt;
&lt;p&gt;中间客户也有叫我检查一下是不是服务器的问题，用工具抓一下微信请求的包，如果返回的code为0，就是请求成功，返回其他值就是不正常，服务器端就有问题。让我先排除一下，结果是code返回0，服务器端OK，没有问题。也就是问题还是在客户端。&lt;/p&gt;
&lt;p&gt;刚开始是怀疑签名有问题，于是用官方的工具检测了下，发现签名最后生成的信息是一样的。这个疑问就排除了。只是当时没想到去排除包名的问题。唉，支付宝怎么就没有这样坑人的问题呢？&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;这两天在集成微信支付的功能，先是客户在插件中集成支付功能，后来发现回调不起来，于是将支付功能集成到了主应用，然后暴露接口给插件使用。费劲几个小时的折腾，于是乎就有下文。&lt;/p&gt;
&lt;p&gt;我们先来看下官网对于code为-1的说明（官网说明地址&lt;a href=&quot;http://kf.qq.com/faq/140225MveaUz150413VNj6nm.html&quot;&gt;点这里&lt;/a&gt;）：&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;开放平台配置的报名和应用签名是否一致：（android）；确认是否使用正式的keystore打包apk并安装调试；（android）；提交订单部分需要在服务器端完成。&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;先请仔细阅读，你遇到的问题就在这段描述中。其中注意，中间还错别字&lt;code&gt;报名&lt;/code&gt;应为&lt;code&gt;包名&lt;/code&gt;（鹅厂果然不一样）。&lt;/p&gt;
    
    </summary>
    
      <category term="pay" scheme="http://www.jacpy.com/categories/pay/"/>
    
    
      <category term="微信支付返回code为-1" scheme="http://www.jacpy.com/tags/%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98%E8%BF%94%E5%9B%9Ecode%E4%B8%BA-1/"/>
    
  </entry>
  
  <entry>
    <title>gradle build报错：Please correct the above warnings first解决方案</title>
    <link href="http://www.jacpy.com/2016/05/10/gradle-build-Please-correct-the-above-warnings-first.html"/>
    <id>http://www.jacpy.com/2016/05/10/gradle-build-Please-correct-the-above-warnings-first.html</id>
    <published>2016-05-10T13:25:04.000Z</published>
    <updated>2016-05-10T13:41:08.000Z</updated>
    
    <content type="html">&lt;p&gt;gradle在build混淆后的代码时，会出现如下错误提示：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;Warning: there were 2 unresolved references to library class members.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;         You probably need to update the library versions.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;         Alternatively, you may have to specify the option &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;         &amp;apos;-dontskipnonpubliclibraryclassmembers&amp;apos;.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;         (http://proguard.sourceforge.net/manual/troubleshooting.html#unresolvedlibraryclassmember)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Warning: Exception while processing task java.io.IOException: Please correct the above warnings first.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;:app:transformClassesAndResourcesWithProguardForRelease FAILED&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;FAILURE: Build failed with an exception.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;* What went wrong:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Execution failed for task &amp;apos;:app:transformClassesAndResourcesWithProguardForRelease&amp;apos;.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; java.io.IOException: Please correct the above warnings first.&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;上面提示编译过程中出现了warning，要求修复，所以停止了编译。按照上面的提示在混淆配置文件&lt;code&gt;proguard-rules.pro&lt;/code&gt;中增加&lt;code&gt;-dontskipnonpubliclibraryclassmembers&lt;/code&gt;项，也不会起作用。只能按上面提示寻找warings，如下Log中的中间两行&lt;code&gt;Waring&lt;/code&gt;：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;Note: the configuration refers to the unknown class &amp;apos;com.alipay.mobile.security.senative.APSE&amp;apos;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Warning: com.baidu.platform.comapi.map.e: can&amp;apos;t find referenced method &amp;apos;float sqrt(float)&amp;apos; in library class android.util.FloatMath&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Warning: com.tencent.connect.avatar.c: can&amp;apos;t find referenced method &amp;apos;float sqrt(float)&amp;apos; in library class android.util.FloatMath&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Note: android.support.v4.text.ICUCompatIcs: can&amp;apos;t find dynamically referenced class libcore.icu.ICU&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;中间两行&lt;code&gt;Warning&lt;/code&gt;是分别使用了百度地图的jar包和QQ第三方登录的jar包，其中使用了FloatMath.sqrt()这个方法后，编译时找不到，原因是使用了android 6.0的jar包去编译。通过查看源代码，发现源码里面有这个方法的实现，但反编译SDK中的&lt;code&gt;android.jar&lt;/code&gt;时，发现里面没有实现，坑！&lt;/p&gt;
&lt;p&gt;之前一直没有使用android 23编译代码，现在项目要兼容6.0，就使用了6.0的编译环境，结果就出现了这样的错。唉，各种坑啊！&lt;/p&gt;
&lt;p&gt;不啰嗦了，上解决方案。&lt;/p&gt;
&lt;p&gt;在&lt;code&gt;proguard-rules.pro&lt;/code&gt;文件中增加如下所示的配置：&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;-dontwarn com.baidu.**&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;-dontwarn com.tencent.**&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;以后遇上这种waring，都可以这样做，&lt;code&gt;-dontwarn&lt;/code&gt;是混淆参数，&lt;code&gt;com.xxx&lt;/code&gt;是包名，也就是忽略这个包名下面的waring。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;gradle在build混淆后的代码时，会出现如下错误提示：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;Warning: there were 2 unresolved references to library class members.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;         You probably need to update the library versions.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;         Alternatively, you may have to specify the option &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;         &amp;apos;-dontskipnonpubliclibraryclassmembers&amp;apos;.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;         (http://proguard.sourceforge.net/manual/troubleshooting.html#unresolvedlibraryclassmember)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Warning: Exception while processing task java.io.IOException: Please correct the above warnings first.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;:app:transformClassesAndResourcesWithProguardForRelease FAILED&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;FAILURE: Build failed with an exception.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;* What went wrong:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Execution failed for task &amp;apos;:app:transformClassesAndResourcesWithProguardForRelease&amp;apos;.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; java.io.IOException: Please correct the above warnings first.&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="gradle" scheme="http://www.jacpy.com/categories/gradle/"/>
    
    
      <category term="Please correct the above warnings first" scheme="http://www.jacpy.com/tags/Please-correct-the-above-warnings-first/"/>
    
  </entry>
  
  <entry>
    <title>gardle编译排除第三方库中的arm64、x86-64中的SO库</title>
    <link href="http://www.jacpy.com/2016/05/10/gradle-compile-exclude-third-library-arm64-x86-64.html"/>
    <id>http://www.jacpy.com/2016/05/10/gradle-compile-exclude-third-library-arm64-x86-64.html</id>
    <published>2016-05-10T13:20:16.000Z</published>
    <updated>2016-09-06T02:53:34.000Z</updated>
    
    <content type="html">&lt;p&gt;在开发android应用时，一般都会用很多的第三方框架。有些框架会提供各个CPU的架构的SO库，比如arm、arm-v7a、x86、mips，有的甚至还提供64位的版本；而有的为了缩小应用包的体积只提供了一些常用的，比如arm，x86。如果应用中有的第三方框架提供了arm和x86的版本，而有的提供了arm，arm-v7a，x86三个版本，那么当运行在arm-v7a版本的CPU上，就会提示找不到只有arm和x86版本的SO库，这样很容易导致应用挂掉，报&lt;code&gt;java.lang.UnsatisfiedLinkError&lt;/code&gt;错误，提示native方法找不到实现。&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;按道理说arm-v7a的CPU会兼容arm版本，但系统去查找SO库的时候却只会在一个目录查找，找完了arm-v7a，没找到不会再去arm目录，这样就会导致兼容性问题。解决方法有两种：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;一种是所有包含有SO库的第三方框架提供最新版本NDK支持的所有的CPU架构SO库，如：armeabi armeabi-v7a x86 mips arm64-v8a x86_64 mips64或者在编译时在Application.mk文件中配置&lt;code&gt;APP_ABI := all&lt;/code&gt;。这样做一般不合适，这样会分散开发者的注意力。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;第二种方法是：应用中所有的包含SO库的第三方框架只能取最小的子集，这种方法比较合适集成第三方框架。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;下面以facebook的fresco框架为例来说明第二种方法的操作方式。&lt;/p&gt;
&lt;p&gt;fresco框架中提供了各个CPU架构的SO库，包括64位的，而自己的应用其他第三方带有SO库的框架A还没有使用64位的SO库，如果不做处理，应用运行在64位手机上，当使用框架A的时候应用就会闪退，因为框架A没有64位的库。那么解决办法只有将fresco库的64位SO库都删除，只保留框架A的相同目录下面的SO库。下面是gradle文件中的配置：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;dependencies &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    compile &amp;apos;com.facebook.fresco:fresco:0.8.1&amp;apos;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;// 将fresco库除armeabi和x86包以外的SO库删除&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;def deleteSO() &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    def rootPath = rootProject.getRootDir().getAbsolutePath() + &amp;apos;/&amp;apos; + project.name&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    delete fileTree(dir: rootPath + &amp;quot;/build/intermediates/exploded-aar/com.facebook.fresco/imagepipeline/&amp;quot; + &amp;quot;$FRESCO_LIB_VERSION&amp;quot; + &amp;quot;/jni/&amp;quot;, excludes: [&amp;apos;**/armeabi/**&amp;apos;, &amp;apos;**/x86/**&amp;apos;])&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;project.afterEvaluate&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    // debug模式下删除SO库&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    tasks.getByName(&amp;apos;prepareDebugDependencies&amp;apos;) &amp;#123; // Hook prepareDebugDependencies任务&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        it.doLast &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            // prepareDebugDependencies任务执行完成后删除SO库&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            deleteSO()&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    // 打包的时候删除SO库&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    tasks.getByName(&amp;apos;prepareReleaseDependencies&amp;apos;) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        it.doLast &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            deleteSO()&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;hr&gt;
&lt;ul&gt;
&lt;li&gt;2016-08-24修改&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;另外还可以使用gradle中的过滤器，可以很方便过滤SO库：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;release &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	ndk &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		abiFilters &amp;quot;armeabi&amp;quot;, &amp;quot;armeabi-v7a&amp;quot;, &amp;quot;x86&amp;quot; // 保留这三种架构的CPU&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;要求gradle版本不低于2.14.1(可以修改项目根目录下的gradle/wrapper/目录下的gradle-wrapper.properties文件内容，将gradle请求地址中的版本号修改)，否则会提示如下错误：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;Gradle DSL method not found: &amp;apos;abiFilter()&amp;apos;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Possible causes:The project &amp;apos;*&amp;apos; may be using a version of the Android Gradle plug-in that does not contain the method (e.g. &amp;apos;testCompile&amp;apos; was added in 1.1.0).&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Fix plugin version and sync projectThe project &amp;apos;*&amp;apos; may be using a version of Gradle that does not contain the method.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Open Gradle wrapper fileThe build file may be missing a Gradle plugin.Apply Gradle plugin&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;在开发android应用时，一般都会用很多的第三方框架。有些框架会提供各个CPU的架构的SO库，比如arm、arm-v7a、x86、mips，有的甚至还提供64位的版本；而有的为了缩小应用包的体积只提供了一些常用的，比如arm，x86。如果应用中有的第三方框架提供了arm和x86的版本，而有的提供了arm，arm-v7a，x86三个版本，那么当运行在arm-v7a版本的CPU上，就会提示找不到只有arm和x86版本的SO库，这样很容易导致应用挂掉，报&lt;code&gt;java.lang.UnsatisfiedLinkError&lt;/code&gt;错误，提示native方法找不到实现。&lt;/p&gt;
    
    </summary>
    
      <category term="gradle" scheme="http://www.jacpy.com/categories/gradle/"/>
    
    
      <category term="gradle 不编译 arm64 x86-64" scheme="http://www.jacpy.com/tags/gradle-%E4%B8%8D%E7%BC%96%E8%AF%91-arm64-x86-64/"/>
    
  </entry>
  
  <entry>
    <title>android studio gradle编译异常小结</title>
    <link href="http://www.jacpy.com/2016/04/22/android-studio-error-collection.html"/>
    <id>http://www.jacpy.com/2016/04/22/android-studio-error-collection.html</id>
    <published>2016-04-22T08:22:30.000Z</published>
    <updated>2016-06-14T03:36:14.000Z</updated>
    
    <content type="html">&lt;blockquote&gt;
&lt;p&gt;在使用android studio过程中，使用gradle编译的时候总会出现一些问题，下面是几个常见问题的解决方法。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;被编译的代码或资源有问题（ finished with non-zero exit value 1）：&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;出现这种编译异常表现是&lt;code&gt;exit value 1&lt;/code&gt;，一般会给出错误提示，所以很容易排查。这种错误很常见，错误提示有时候是在日志中明显的给出来了，如下示例所示：&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;:app:processDebugManifest&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;:app:processDebugResources&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;\app\src\main\res\layout\activity_welcome.xml&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Error:(42, 26) No resource found that matches the given name (at &amp;apos;src&amp;apos; with value &amp;apos;@drawable/welcome_03&amp;apos;).&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Error:Execution failed for task &amp;apos;:app:processDebugResources&amp;apos;.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;com.android.ide&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;.common.process.ProcessException: org.gradle.process.internal.ExecException: &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Process &amp;apos;command &amp;apos;D:\android-sdk-windows\build-tools\22.0.1\aapt.exe&amp;apos;&amp;apos; finished with non-zero exit value 1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;上面错误提示找不到welcome_03这个drawable资源。有时候没有明显的提示，如下面这种错误：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;:app:transformClassesWithMultidexlistForDebug UP-TO-DATE&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;:app:transformClassesWithDexForDebug FAILED&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Error:Execution failed for task &amp;apos;:app:transformClassesWithDexForDebug&amp;apos;.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;gt; com.android.build.api.transform.TransformException: &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;com.android.ide.common.process.ProcessException: java.util.concurrent.ExecutionException: &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;com.android.ide.common.process.ProcessException: org.gradle.process.internal.ExecException: &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Process &amp;apos;command &amp;apos;C:\Program Files\Java\jdk1.7.0_79\bin\java.exe&amp;apos;&amp;apos; finished with non-zero exit value 1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;上面这种错误没有给出很显示的提示，但是可以知道是在执行&lt;code&gt;Error:Execution failed for task &amp;#39;:app:transformClassesWithDexForDebug&amp;#39;&lt;/code&gt;这一步出错了，至少缩小了错误的排查范围，这个时候就需要经验来判断了，自己之前改过什么，自己回想一下。有时候往上面看错误日志，也会发现有很明显的错误提示。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;jar包冲突（finished with non-zero exit value 2）：&lt;br&gt;主要表现为编译后出现&lt;strong&gt;finished with non-zero exit value 2&lt;/strong&gt;错误，原因是jar包冲突，导致的原因可能是在dependencies中使用compile files()导入一次jar包，然后有其它jar的引入方式使用compile’com.xxx’方式，正好又引用了这个jar包，所以导致了重复引用jar包的冲突。最常见的是support-v4包的重复引用。具体报错如下所示：&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;Error:Execution failed for task &amp;apos;:task:transformClassesWithDexForDebug&amp;apos;.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;com.android.build.api.transform.TransformException: &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;com.android.ide.common.process.ProcessException: org.gradle.process.internal.ExecException:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Process &amp;apos;command &amp;apos;C:\Java\jdk1.7.0_79\bin\java.exe&amp;apos;&amp;apos; finished with non-zero exit value 2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;编译的代码过多导致内存不足（finished with non-zero exit value 3）：&lt;br&gt;主要表现为编译后出现&lt;strong&gt;finished with non-zero exit value 3&lt;/strong&gt;错误，原因是因为编译的java代码过多，通常是方法数超过65535后使用了分包的机制，gradle在编译的时候由于编译的内存需要不能满足而导致错误。具体报错内容如下所示：&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;Error:java.lang.OutOfMemoryError: GC overhead limit exceeded&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Error:Execution failed for task &amp;apos;:app:transformClassesWithDexForRelease&amp;apos;.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;com.android.build.api.transform.TransformException: &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;com.android.ide.common.process.ProcessException: java.util.concurrent.ExecutionException: &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;com.android.ide.common.process.ProcessException: org.gradle.process.internal.ExecException: &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Process &amp;apos;command &amp;apos;C:\Java\jdk1.7.0_79\bin\java.exe&amp;apos;&amp;apos; finished with non-zero exit value 3&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;解决方案是在gradle文件中的android代码块内增加如下内容即可解决：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;android &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    // ...&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    dexOptions &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	javaMaxHeapSize &amp;quot;4g&amp;quot;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;或者修改android studio的安装目录下的bin目录中的studio.vmoptions文件中的&lt;code&gt;Xms&lt;/code&gt;和&lt;code&gt;Xmx&lt;/code&gt;两项，将其值改大，如下所示：&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;-Xms256m&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;-Xmx1280m&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;出现这种情况的原因是因为项目太大，编译需要更多的内存。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;在使用android studio过程中，使用gradle编译的时候总会出现一些问题，下面是几个常见问题的解决方法。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;被编译的代码或资源有问题（ finished with non-zero exit value 1）：&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;出现这种编译异常表现是&lt;code&gt;exit value 1&lt;/code&gt;，一般会给出错误提示，所以很容易排查。这种错误很常见，错误提示有时候是在日志中明显的给出来了，如下示例所示：&lt;/p&gt;
    
    </summary>
    
      <category term="android studio" scheme="http://www.jacpy.com/categories/android-studio/"/>
    
    
      <category term="transformClassesWithDexForDebug" scheme="http://www.jacpy.com/tags/transformClassesWithDexForDebug/"/>
    
  </entry>
  
  <entry>
    <title>AndFix加载补丁包过程分析</title>
    <link href="http://www.jacpy.com/2016/03/24/andfix-load-patch-analysis.html"/>
    <id>http://www.jacpy.com/2016/03/24/andfix-load-patch-analysis.html</id>
    <published>2016-03-24T06:42:58.000Z</published>
    <updated>2016-03-24T06:58:22.000Z</updated>
    
    <content type="html">&lt;h3 id=&quot;AndFix加载补丁包过程分析&quot;&gt;&lt;a href=&quot;#AndFix加载补丁包过程分析&quot; class=&quot;headerlink&quot; title=&quot;AndFix加载补丁包过程分析&quot;&gt;&lt;/a&gt;AndFix加载补丁包过程分析&lt;/h3&gt;&lt;p&gt;andfix提供了一套可以热替换java中原有方法的工具，在实际应用中可以用来热替换修复出现bug的方法，从而使用应用不需要升级应用就能解决部分问题。&lt;/p&gt;
&lt;p&gt;本文主要是分析运行在android应用中的一套工具环境，从java层到native层分析andfix框架热替换方法的过程。&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h4 id=&quot;一、解析补丁包&quot;&gt;&lt;a href=&quot;#一、解析补丁包&quot; class=&quot;headerlink&quot; title=&quot;一、解析补丁包&quot;&gt;&lt;/a&gt;一、解析补丁包&lt;/h4&gt;&lt;p&gt;首先来看andfix初始化代码：&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; com.alipay.euler.andfix.patch.PatchManager;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;App&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Application&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onCreate&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt;.onCreate();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        String patchPath = &lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        PatchManager patchManager = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; PatchManager(getApplicationContext());&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        patchManager.init(&lt;span class=&quot;string&quot;&gt;&quot;1.0&quot;&lt;/span&gt;);&lt;span class=&quot;comment&quot;&gt;//current version&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        patchManager.addPatch(patchPath);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        patchManager.loadPatch();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;一般这段初始化代码是放在Application的onCreate()方法中，原因是应用启动时，尽早替换出现问题的方法，等到方法执行时再替换就无意义了。&lt;/p&gt;
&lt;p&gt;在PatchManager对象调用init(String)方法时，传入的版本号值很关键。如果是初次初始化或者版本号发生变化，那么会清空原来已经缓存的patch包，同时会缓存新的版本号；如果不是，则会加载已经缓存过的patch包并解析成Patch对象缓存到集合中。&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; * initialize&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; *&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; * &lt;span class=&quot;doctag&quot;&gt;@param&lt;/span&gt; appVersion&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; *            App version&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; */&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String appVersion)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!mPatchDir.exists() &amp;amp;&amp;amp; !mPatchDir.mkdirs()) &amp;#123;&lt;span class=&quot;comment&quot;&gt;// make directory fail&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		Log.e(TAG, &lt;span class=&quot;string&quot;&gt;&quot;patch dir create error.&quot;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	&amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!mPatchDir.isDirectory()) &amp;#123;&lt;span class=&quot;comment&quot;&gt;// not directory&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		mPatchDir.delete();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	SharedPreferences sp = mContext.getSharedPreferences(SP_NAME,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;			Context.MODE_PRIVATE);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	String ver = sp.getString(SP_VERSION, &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (ver == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt; || !ver.equalsIgnoreCase(appVersion)) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		cleanPatch();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		sp.edit().putString(SP_VERSION, appVersion).commit();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	&amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		initPatchs();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;addPatch(String)的功能是加载patch包，并将patch包缓存到应用的/data/data/packageName/files/apatch/目录下。如果该缓存目录下已存在，则不会重复缓存。&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; * add patch at runtime&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; *&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; * &lt;span class=&quot;doctag&quot;&gt;@param&lt;/span&gt; path&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; *            patch path&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; * &lt;span class=&quot;doctag&quot;&gt;@throws&lt;/span&gt; IOException&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; */&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;addPatch&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String path)&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;throws&lt;/span&gt; IOException &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	File src = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; File(path);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	File dest = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; File(mPatchDir, src.getName());&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(!src.exists())&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; FileNotFoundException(path);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (dest.exists()) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		Log.d(TAG, &lt;span class=&quot;string&quot;&gt;&quot;patch [&quot;&lt;/span&gt; + path + &lt;span class=&quot;string&quot;&gt;&quot;] has be loaded.&quot;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	FileUtil.copyFile(src, dest);&lt;span class=&quot;comment&quot;&gt;// copy to patch&#39;s directory&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	Patch patch = addPatch(dest);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (patch != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		loadPatch(patch);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;patch包解析构造成Patch类对象时，主要是解析patch包中的META-INF/PATCH.MF文件，将该文件中的Patch-Classes项对应的值解析出来，在前面 &lt;a href=&quot;/2016/03/24/apkpatch-tool-analysis.html&quot;&gt;apkpatch工具实现分析&lt;/a&gt; 一文中有介绍，这个字段对应的值是将修复的Class以英文逗号分隔组成。&lt;/p&gt;
&lt;h4 id=&quot;二、加载补丁包中的类&quot;&gt;&lt;a href=&quot;#二、加载补丁包中的类&quot; class=&quot;headerlink&quot; title=&quot;二、加载补丁包中的类&quot;&gt;&lt;/a&gt;二、加载补丁包中的类&lt;/h4&gt;&lt;p&gt;加载补丁包中的类并替换相应的方法是通过调用PatchManager的loadPatch()方法完成的。该方法是将缓存的patch中的Class名称，通过调用AndFixManager类的fix(File, ClassLoader, List&lt;string&gt;)方法转换成对应的Class类。&lt;/string&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;final DexFile dexFile = DexFile.loadDex(file.getAbsolutePath(),&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;					optfile.getAbsolutePath(), Context.MODE_PRIVATE);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;if (saveFingerprint) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	mSecurityChecker.saveOptSig(optfile);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;ClassLoader patchClassLoader = new ClassLoader(classLoader) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	@Override&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	protected Class&amp;lt;?&amp;gt; findClass(String className)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;			throws ClassNotFoundException &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		Class&amp;lt;?&amp;gt; clazz = dexFile.loadClass(className, this);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		if (clazz == null&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;				&amp;amp;&amp;amp; className.startsWith(&amp;quot;com.alipay.euler.andfix&amp;quot;)) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;			return Class.forName(className);// annotation’s class not found&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		if (clazz == null) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;			throw new ClassNotFoundException(className);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		return clazz;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;在fix()方法中会进行patch包的版本支持校验和安全校验，如果不支持或者校验不通过，则不会继续执行。在这个方法中以Patch包的路径为参数创建了DexFile类对象，并构造了ClassLoader类，并重写了其findClass(String)方法，ClassLoader去查找Class的时候，实际上是调用DexFile.loadClass(String, ClassLoader)方法来完成的。&lt;/p&gt;
&lt;p&gt;最后是调用DexFile.entries()方法该patch包中所有的类名，将这些已经在Patch-Classes中的类名通过调用DexFile.loadClass(String, ClassLoader)获取对应的Class。&lt;/p&gt;
&lt;p&gt;方法替换是通过调用AndFixManager的fixClass(Class, ClassLoader)方法实现，该方法中先找出该Class中的有MethodReplace注解的方法，然后拿出该注解的clz(原方法对应的类名)和meth(原方法名称)字段的值，获取到原方法的Method对象，最后通过执行AndFix.addReplaceMethod(Method, Method)方法调用replaceMethod(Method, Method)方法进而转入native层进行方法替换操作。&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; * fix class&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; *&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; * &lt;span class=&quot;doctag&quot;&gt;@param&lt;/span&gt; clazz&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; *            class&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; */&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;fixClass&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Class&amp;lt;?&amp;gt; clazz, ClassLoader classLoader)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	Method[] methods = clazz.getDeclaredMethods();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	MethodReplace methodReplace;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	String clz;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	String meth;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (Method method : methods) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		methodReplace = method.getAnnotation(MethodReplace.class);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (methodReplace == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;			&lt;span class=&quot;keyword&quot;&gt;continue&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		clz = methodReplace.clazz();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		meth = methodReplace.method();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!isEmpty(clz) &amp;amp;&amp;amp; !isEmpty(meth)) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;			replaceMethod(classLoader, clz, meth, method);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;三、安全校验&quot;&gt;&lt;a href=&quot;#三、安全校验&quot; class=&quot;headerlink&quot; title=&quot;三、安全校验&quot;&gt;&lt;/a&gt;三、安全校验&lt;/h4&gt;&lt;p&gt;是否支持方法热替换操作的是通过AndFixManager的mSupport属性判断。该属性是通过调用Compact.isSupport()方法返回的值，在该方法中会判断是否不是阿里云OS系统、调用native中的setup根据不同虚拟机初始化是否成功、判断android系统版本是否是在2.3 ~ 6.0之间。&lt;/p&gt;
&lt;p&gt;安全校验分两步：第一是校验patch包的签名是否与主应用的签名一致，如果主应用是调试的签名，也给予通过，这样做是为了调试方便。该过程是在SecurityChecker的verifyApk(File)方法中实现。&lt;/p&gt;
&lt;p&gt;第二步验证的是验证patch包中优化过的classes.dex文件，即odex或oat文件，只不过andfix将该生成的文件名修改为与patch包名称相同，放在了apatch_opt目录。该验证过程是通过比较优化后的odex文件的MD5值与上次获取优化后的odex文件缓存的MD5值，如果不相同，则会删除odex文件，重新调用SecurityChecker类的saveOptSig(File)方法缓存新生成的odex文件的MD5值。&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; * &lt;span class=&quot;doctag&quot;&gt;@param&lt;/span&gt; file&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; *            Dex file&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; * &lt;span class=&quot;doctag&quot;&gt;@return&lt;/span&gt; true if verify fingerprint success&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; */&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;verifyOpt&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(File file)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	String fingerprint = getFileMD5(file);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	String saved = getFingerprint(file.getName());&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (fingerprint != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; TextUtils.equals(fingerprint, saved)) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;四、Dalvik虚拟机方法替换&quot;&gt;&lt;a href=&quot;#四、Dalvik虚拟机方法替换&quot; class=&quot;headerlink&quot; title=&quot;四、Dalvik虚拟机方法替换&quot;&gt;&lt;/a&gt;四、Dalvik虚拟机方法替换&lt;/h4&gt;&lt;p&gt;java层在调用AndFix类的replaceMethod()方法时，就转入了native层，在native层，该本地方法对应的函数是static void replaceMethod(JNIEnv* env, jclass clazz, jobject src,&lt;br&gt;        jobject dest)，中间使用了JNI中的主动注册的方式进行关联。如下代码所示：&lt;/p&gt;
&lt;figure class=&quot;highlight cpp&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/*&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; * JNI registration.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; */&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; JNINativeMethod gMethods[] = &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/* name, signature, funcPtr */&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123; &lt;span class=&quot;string&quot;&gt;&quot;setup&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;(ZI)Z&quot;&lt;/span&gt;, (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;*) setup &amp;#125;, &amp;#123; &lt;span class=&quot;string&quot;&gt;&quot;replaceMethod&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		&lt;span class=&quot;string&quot;&gt;&quot;(Ljava/lang/reflect/Method;Ljava/lang/reflect/Method;)V&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		(&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;*) replaceMethod &amp;#125;, &amp;#123; &lt;span class=&quot;string&quot;&gt;&quot;setFieldFlag&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		&lt;span class=&quot;string&quot;&gt;&quot;(Ljava/lang/reflect/Field;)V&quot;&lt;/span&gt;, (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;*) setFieldFlag &amp;#125;, &amp;#125;;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;在replaceMethod函数中根据当前是DVM还是ART虚拟机，分别调用dalvik_replaceMethod()和art_replaceMethod()函数。&lt;/p&gt;
&lt;p&gt;dalvik_replaceMethod()函数的定义是在jni/dalvik/dalvik_method_replace.cpp文件中。其中通过调用JNIEnv的FromReflectedMethod()函数获取java层Method类对象对应native层的Method结构体，然后修改该结构体中的accessFlags和jniArgInfo属性值，使这个java层的普通方法变成一个native方法。同时还修改了insns和nativeFunc属性，insns缓存的是已经修复bug的函数的Method结构体指针；nativeFunc属性值是dalvik_dispatcher函数地址，虚拟机在执行方法时，如果该方法是本地方法就会执行nativeFunc所指向的函数地址，也就是会执行dalvik_dispatcher函数。&lt;/p&gt;
&lt;figure class=&quot;highlight cpp&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Method* meth = (Method*) env-&amp;gt;FromReflectedMethod(src);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Method* target = (Method*) env-&amp;gt;FromReflectedMethod(dest);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;LOGD(&lt;span class=&quot;string&quot;&gt;&quot;dalvikMethod: %s&quot;&lt;/span&gt;, meth-&amp;gt;name);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;meth-&amp;gt;jniArgInfo = &lt;span class=&quot;number&quot;&gt;0x80000000&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;meth-&amp;gt;accessFlags |= ACC_NATIVE;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; argsSize = dvmComputeMethodArgsSize_fnPtr(meth);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!dvmIsStaticMethod(meth))&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	argsSize++;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;meth-&amp;gt;registersSize = meth-&amp;gt;insSize = argsSize;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;meth-&amp;gt;insns = (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;*) target;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;meth-&amp;gt;nativeFunc = dalvik_dispatcher;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;在dalvik_dispatcher()函数中，会根据当前替换方法，即修复bug的方法是否是静态方法而分别做处理。这个与java语法相同，如果调用的是非静态方法，则会需要当前方法所在类的对象来调用，如果是静态方法，则只需要类即可。不管是处理哪种类型的方法，都会调用到dvmCallMethod_fnPtr()函数。这个函数是通过使用NDK中的&lt;dlfcn.h&gt;头文件中的相关函数打开android系统中的/system/lib/libdvm.so文件，使用dvmCallMethod名称获取到的函数地址，也就是说调用dvmCallMethod_fnPtr()函数，实际上是调用dvm虚拟机中的dvmCallMethod()函数，这个函数是在android系统源码中的dalvik/vm/interp/Stack.cpp文件中定义。上面获取函数地址的方法可以参见dalvik_setup()函数定义。通过dvmCallMethod()函数名称也能明白，该函数是虚拟机用来执行java层方法的。&lt;/dlfcn.h&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight cpp&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!dvmIsStaticMethod(meth)) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	&lt;span class=&quot;comment&quot;&gt;// 中间代码省略 ...&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	dvmCallMethod_fnPtr(self, (Method*) jInvokeMethod,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;			dvmCreateReflectMethodObject_fnPtr(meth), &amp;amp;result, thisObj,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;			argArray);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	thisObj-&amp;gt;clazz = tmp;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	&lt;span class=&quot;comment&quot;&gt;// 中间代码省略 ...&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	dvmCallMethod_fnPtr(self, (Method*) jInvokeMethod,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;			dvmCreateReflectMethodObject_fnPtr(meth), &amp;amp;result, &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;			argArray);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;注意，dvmCallMethod()函数传入的第二个参数是一个Method结构体指针，也就是当需要被执行的方法，但这个方法jInvokeMethod是一个java层的java.lang.reflect.Method的invoke()方法，是通过使用JNI的GetMethodID()函数获取到其对应ID作为一个参数，具体是在dalvik_setup()函数中获取；第三个参数才是替换方法，这个参数在dvmCallMethod()函数中作为被执行方法的调用对象。到这里应该能明白，实际上对应java层的调用是执行java.lang.reflect.Method对象的invoke()方法。&lt;/p&gt;
&lt;p&gt;在dalvik_dispatcher()函数的最后是处理异常和返回结果。&lt;/p&gt;
&lt;h4 id=&quot;五、ART虚拟机方法替换&quot;&gt;&lt;a href=&quot;#五、ART虚拟机方法替换&quot; class=&quot;headerlink&quot; title=&quot;五、ART虚拟机方法替换&quot;&gt;&lt;/a&gt;五、ART虚拟机方法替换&lt;/h4&gt;&lt;p&gt;art_replaceMethod()函数是在jni/art/art_method_replace.cpp文件中定义，该函数主要内容是根据ART虚拟机不同的版本，调用不同的函数。下面是具体代码：&lt;/p&gt;
&lt;figure class=&quot;highlight cpp&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;extern&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;__&lt;/span&gt;attribute__ ((visibility (&lt;span class=&quot;string&quot;&gt;&quot;hidden&quot;&lt;/span&gt;))) art_replaceMethod(&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		JNIEnv* env, jobject src, jobject dest) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (apilevel &amp;gt; &lt;span class=&quot;number&quot;&gt;22&lt;/span&gt;) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		replace_6_0(env, src, dest);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	&amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (apilevel &amp;gt; &lt;span class=&quot;number&quot;&gt;21&lt;/span&gt;) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		replace_5_1(env, src, dest);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	&amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		replace_5_0(env, src, dest);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;这几个函数分别是在对应的jni/art/art_method_replace_x_x.cpp文件中定义。因为ART虚拟机还不太成熟，google还在改进中，所以不同版本有些代码会不一样，才会针对不同的版本进行处理。&lt;/p&gt;
&lt;p&gt;这里从java层过来的Method对象，被转换成ART虚拟机中能识别的ArtMethod类指针。这些函数中处理都是相同的，将被替换方法和替换方法两个方法的属性值进行互相替换。这里的处理方式与DVM有很大不同，ART中只需要替换相应的属性，不需要进行方法调用，这与ART虚拟机原理有关。其中下面两个属性替换很关键：&lt;/p&gt;
&lt;figure class=&quot;highlight cpp&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;smeth-&amp;gt;entry_point_from_compiled_code_ =&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;			dmeth-&amp;gt;entry_point_from_compiled_code_;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;smeth-&amp;gt;entry_point_from_interpreter_ = dmeth-&amp;gt;entry_point_from_interpreter_;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;entry_point_from&lt;em&gt;interpreter&lt;/em&gt;可以认为是ART虚拟机执行方法的起点，这个指针实际上是一个函数指针，这个函数指针是由汇编实现，这个指针是在art/runtime/class_linker.cc文件中赋值，再往下找，就会找到汇编代码。&lt;br&gt;entry_point_from_compiled&lt;em&gt;code&lt;/em&gt;这个指针同理，当ART虚拟机执行代码，如果需要Interpreter，就会执行entry_point_from&lt;em&gt;interpreter&lt;/em&gt;指向的函数；如果不需要，则会执行entry_point_from_compiled&lt;em&gt;code&lt;/em&gt;指向的函数。两个函数之间又可以相互调用，这部分都是用汇编代码执行的。具体原理参见CSDN老罗的博客。&lt;/p&gt;
&lt;p&gt;– EOF –&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;AndFix加载补丁包过程分析&quot;&gt;&lt;a href=&quot;#AndFix加载补丁包过程分析&quot; class=&quot;headerlink&quot; title=&quot;AndFix加载补丁包过程分析&quot;&gt;&lt;/a&gt;AndFix加载补丁包过程分析&lt;/h3&gt;&lt;p&gt;andfix提供了一套可以热替换java中原有方法的工具，在实际应用中可以用来热替换修复出现bug的方法，从而使用应用不需要升级应用就能解决部分问题。&lt;/p&gt;
&lt;p&gt;本文主要是分析运行在android应用中的一套工具环境，从java层到native层分析andfix框架热替换方法的过程。&lt;/p&gt;
    
    </summary>
    
      <category term="andfix" scheme="http://www.jacpy.com/categories/andfix/"/>
    
    
      <category term="andfix" scheme="http://www.jacpy.com/tags/andfix/"/>
    
  </entry>
  
  <entry>
    <title>apkpatch工具实现分析</title>
    <link href="http://www.jacpy.com/2016/03/24/apkpatch-tool-analysis.html"/>
    <id>http://www.jacpy.com/2016/03/24/apkpatch-tool-analysis.html</id>
    <published>2016-03-24T05:27:17.000Z</published>
    <updated>2016-03-24T06:49:22.000Z</updated>
    
    <content type="html">&lt;h3 id=&quot;apkpatch工具实现分析&quot;&gt;&lt;a href=&quot;#apkpatch工具实现分析&quot; class=&quot;headerlink&quot; title=&quot;apkpatch工具实现分析&quot;&gt;&lt;/a&gt;apkpatch工具实现分析&lt;/h3&gt;&lt;p&gt;apkpatch工具是配套阿里AndFix框架的一个生成aptach补丁包的工具，链接地址是：&lt;a href=&quot;https://github.com/alibaba/AndFix/tree/master/tools&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/alibaba/AndFix/tree/master/tools&lt;/a&gt; 。主要包含反编译对比两个APK的类和方法、修改类名写入PACTH.MF文件、生成补丁apatch包。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;由于没有从网上找到对应的源码，以下分析过程均通过jd-gui工具反编译jar包阅读反编译代码完成。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h4 id=&quot;一、工具入口&quot;&gt;&lt;a href=&quot;#一、工具入口&quot; class=&quot;headerlink&quot; title=&quot;一、工具入口&quot;&gt;&lt;/a&gt;一、工具入口&lt;/h4&gt;&lt;p&gt;从命令行执行apkpatch命令时，调用的是com.euler.patch.Main类中的静态main()方法。通过对参数的解析，解析出两个APK的路径及签名文件相关信息。根据命令参数的不同，主要分为两个过程，第一个过程是如果参数中有&lt;strong&gt;-m&lt;/strong&gt;参数，那么会执行补丁包的合并过程，即将&lt;strong&gt;-m&lt;/strong&gt;参数指定的文件合并到一个merge.aptach文件中；另外一个过程是通过构造com.euler.patch.ApkPatch类对象，调用其doPatch()方法，启动生成补丁包。&lt;/p&gt;
&lt;p&gt;解析&lt;strong&gt;-m&lt;/strong&gt;参数为合并代码逻辑反编译代码如下图所示：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/2016/03/24/merge_patch.jpg&quot; alt=&quot;解析参数为合并&quot;&gt;&lt;/p&gt;
&lt;p&gt;生成补丁包的逻辑反编译代码如下图所示：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/2016/03/24/make_patch.jpg&quot; alt=&quot;生成补丁包&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;二、补丁包合并&quot;&gt;&lt;a href=&quot;#二、补丁包合并&quot; class=&quot;headerlink&quot; title=&quot;二、补丁包合并&quot;&gt;&lt;/a&gt;二、补丁包合并&lt;/h3&gt;&lt;p&gt;合并操作是调用com.euler.patch.MergePatch类中的doMerge()方法，其中会调用mergeCode(File)方法，将需要的合并的patch包中的classes.dex合并到一个dex文件中。合并过程是通过调用调用com.android.dx.merge.DexMerger类merge()方法完成。&lt;/p&gt;
&lt;h3 id=&quot;三、生成补丁包&quot;&gt;&lt;a href=&quot;#三、生成补丁包&quot; class=&quot;headerlink&quot; title=&quot;三、生成补丁包&quot;&gt;&lt;/a&gt;三、生成补丁包&lt;/h3&gt;&lt;p&gt;&lt;img src=&quot;/images/2016/03/24/do_patch.jpg&quot; alt=&quot;生成补丁包&quot;&gt;&lt;/p&gt;
&lt;h4 id=&quot;3-1、对比两个APK的类和方法&quot;&gt;&lt;a href=&quot;#3-1、对比两个APK的类和方法&quot; class=&quot;headerlink&quot; title=&quot;3.1、对比两个APK的类和方法&quot;&gt;&lt;/a&gt;3.1、对比两个APK的类和方法&lt;/h4&gt;&lt;p&gt;在执行apkpatch工具时，命令参数&lt;strong&gt;-f&lt;/strong&gt;表示的是新生成的APK，&lt;strong&gt;-t&lt;/strong&gt;参数表示的是原APK包，两个APK不同的信息保存在com.euler.patch.diff.DiffInfo类实例中，其中包括，不同的类信息、方法信息以及属性信息。这些不同的信息是通过调用com.euler.patch.diff.DexDiffer类的diff()方法获取。&lt;/p&gt;
&lt;p&gt;这里有个关键的地方是将修改的方法，也可以说是出现bug的方法会增加一个&lt;strong&gt;Lcom/alipay/euler/andfix/annotation/MethodReplace;&lt;/strong&gt;注解，在android加载补丁包的环境中，方法替换是根据方法是否有@MethodReplace注解而进行替换的。&lt;/p&gt;
&lt;p&gt;通过调用ApkPatch类的buildCode(File, File, DiffInfo)方法，将所有新增的类或发生修改的类根据类名将类的信息转换成smali格式的文件，修改类名信息后，即加上_CF后缀，重新生成新的新的dex文件。&lt;/p&gt;
&lt;h4 id=&quot;3-2、写入PACTH-MF文件&quot;&gt;&lt;a href=&quot;#3-2、写入PACTH-MF文件&quot; class=&quot;headerlink&quot; title=&quot;3.2、写入PACTH.MF文件&quot;&gt;&lt;/a&gt;3.2、写入PACTH.MF文件&lt;/h4&gt;&lt;p&gt;紧接着调用ApkPatch的父类，即Build类的build(File, File)方法打成APK包，同时调用getMeta()方法写入PATCH.MF文件补丁包信息。getMeta()方法具体实现是在ApkPatch类中，注意PATCH.MF文件中的Patch-Classes字段对应的内容是带_CF后缀的类名。这个在android运行环境中解析的时候会用到这个字段。&lt;/p&gt;
&lt;p&gt;getMeta()方法反编译代码如下所示：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/2016/03/24/get_meta.jpg&quot; alt=&quot;写入MF信息&quot;&gt;&lt;/p&gt;
&lt;p&gt;最后是调用Build类中的release()方法对打包的APK文件进行签名，生成包含签名信息的patch包。&lt;/p&gt;
&lt;p&gt;– EOF –&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;apkpatch工具实现分析&quot;&gt;&lt;a href=&quot;#apkpatch工具实现分析&quot; class=&quot;headerlink&quot; title=&quot;apkpatch工具实现分析&quot;&gt;&lt;/a&gt;apkpatch工具实现分析&lt;/h3&gt;&lt;p&gt;apkpatch工具是配套阿里AndFix框架的一个生成aptach补丁包的工具，链接地址是：&lt;a href=&quot;https://github.com/alibaba/AndFix/tree/master/tools&quot;&gt;https://github.com/alibaba/AndFix/tree/master/tools&lt;/a&gt; 。主要包含反编译对比两个APK的类和方法、修改类名写入PACTH.MF文件、生成补丁apatch包。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;由于没有从网上找到对应的源码，以下分析过程均通过jd-gui工具反编译jar包阅读反编译代码完成。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="andfix" scheme="http://www.jacpy.com/categories/andfix/"/>
    
    
      <category term="andfix apkpatch" scheme="http://www.jacpy.com/tags/andfix-apkpatch/"/>
    
  </entry>
  
  <entry>
    <title>Genymotion模拟器长期使用占用大量磁盘空间解决方案</title>
    <link href="http://www.jacpy.com/2015/10/30/clear-genymotion-virturebox-cache-md.html"/>
    <id>http://www.jacpy.com/2015/10/30/clear-genymotion-virturebox-cache-md.html</id>
    <published>2015-10-30T12:54:28.000Z</published>
    <updated>2015-10-30T15:34:48.000Z</updated>
    
    <content type="html">&lt;p&gt;今天下午在调应用，突然Android Studio弹出&lt;code&gt;Low disk space on a Android Studio system directory partition&lt;/code&gt;提示，磁盘空间不够了？赶紧跑去看了磁盘用量。傻眼了，早上来还有几百M的C盘，现在只剩下几十M了。早在之前就已经注意到了C盘容量会莫名的减少，但是没有注意是哪个程序占用了更多的空间，今天决定要找找，于是就有了下文。&lt;/p&gt;
&lt;h3 id=&quot;1-二分法找出磁盘占用空间最大的目录&quot;&gt;&lt;a href=&quot;#1-二分法找出磁盘占用空间最大的目录&quot; class=&quot;headerlink&quot; title=&quot;1.二分法找出磁盘占用空间最大的目录&quot;&gt;&lt;/a&gt;1.二分法找出磁盘占用空间最大的目录&lt;/h3&gt;&lt;p&gt;Win 7的应用程序缓存目录是在&lt;code&gt;C:\Users\jacpy\AppData&lt;/code&gt;目录中，&lt;code&gt;jacpy&lt;/code&gt;为当前系统用户名。&lt;code&gt;AppData&lt;/code&gt;为隐藏目录，要在目录菜单的“组织”中找到“文件夹和搜索选项”的弹出框的“查看”Tab页中修改，不会修改也没关系，打开一个目录，把上面的路径直接copy到路径框里面，把用户名换成自己的电脑用户名，回车就行了。&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;&lt;code&gt;AppData&lt;/code&gt;目录下面只有几个目录，所以挨个看下属性就知道，找占用空间最大的目录进去，无疑是&lt;code&gt;Local&lt;/code&gt;目录，实际上应用程序的缓存大部分在这个目录中。&lt;code&gt;Local&lt;/code&gt;目录中有N多目录，如果你装了很多的应用程序的话，OK，现在二分法表现的时候了。先选中目录中一半的目录，看一下属性，统计这些目录的磁盘占用的空间，也不用选择一半，差不多就行。然后在占用空间大的那部分目录里再进行同样的处理方式，传说中的logn级别的查找效率体现出来了有没有啊。很意外，找到的是Genymobile目录，通过观察其他子目录发现，也在意料之中。&lt;/p&gt;
&lt;h3 id=&quot;2-删除Genymotion的Snapshots文件目录&quot;&gt;&lt;a href=&quot;#2-删除Genymotion的Snapshots文件目录&quot; class=&quot;headerlink&quot; title=&quot;2.删除Genymotion的Snapshots文件目录&quot;&gt;&lt;/a&gt;2.删除Genymotion的Snapshots文件目录&lt;/h3&gt;&lt;p&gt;通过上面的二分法在Genymobile目录中找到空间占用最多的文件，最后是在&lt;code&gt;Google Nexus 4 - 4.2.2 - API 17 - 768x1280&lt;/code&gt;中的Snapshots目录中找到了一个有6个G的vdi文件，好家伙，这是什么鬼，这么大！立马删除。然后再去启动模拟器，启动不了。好吧，估计是组成的文件缺一不可吧，最后把&lt;code&gt;Google Nexus 4 - 4.2.2 - API 17 - 768x1280&lt;/code&gt;整个文件夹都删除了，打算重新再下载这个模拟器。&lt;/p&gt;
&lt;h3 id=&quot;3-重新部署Genymotion模拟器&quot;&gt;&lt;a href=&quot;#3-重新部署Genymotion模拟器&quot; class=&quot;headerlink&quot; title=&quot;3.重新部署Genymotion模拟器&quot;&gt;&lt;/a&gt;3.重新部署Genymotion模拟器&lt;/h3&gt;&lt;p&gt;打开Genymotion的PC端，选择还是那个模拟器镜像，然后下载，结果瞬间完成。&lt;br&gt;&lt;img src=&quot;https://raw.githubusercontent.com/jacpy/jacpy.github.io/master/images/2015/10/30/genymotion_pc.png&quot; alt=&quot;Genymotion PC端截图&quot;&gt;&lt;br&gt;难道本地有缓存？又在目录里面找了一圈，发现在&lt;code&gt;ova&lt;/code&gt;目录中有ova缓存文件。&lt;br&gt;&lt;img src=&quot;https://raw.githubusercontent.com/jacpy/jacpy.github.io/master/images/2015/10/30/genymotion_cache_file.jpg&quot; alt=&quot;缓存文件截图&quot;&gt;&lt;/p&gt;
&lt;p&gt;究其原理肯定是VirtureBox虚拟机文件越用越大，因为最近用模拟器调试应用（既然免费用别人的工具，打一下广告，Genymotion模拟器速度确实很快，比我的物理机速度还快，尤其是调试时安装应用的速度），时间长了，用的多了，虚拟机文件就会变得很大，跟vmare一个德性。&lt;/p&gt;
&lt;p&gt;干掉那么大一个文件，C盘又空出来很多空间，心里很爽。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;今天下午在调应用，突然Android Studio弹出&lt;code&gt;Low disk space on a Android Studio system directory partition&lt;/code&gt;提示，磁盘空间不够了？赶紧跑去看了磁盘用量。傻眼了，早上来还有几百M的C盘，现在只剩下几十M了。早在之前就已经注意到了C盘容量会莫名的减少，但是没有注意是哪个程序占用了更多的空间，今天决定要找找，于是就有了下文。&lt;/p&gt;
&lt;h3 id=&quot;1-二分法找出磁盘占用空间最大的目录&quot;&gt;&lt;a href=&quot;#1-二分法找出磁盘占用空间最大的目录&quot; class=&quot;headerlink&quot; title=&quot;1.二分法找出磁盘占用空间最大的目录&quot;&gt;&lt;/a&gt;1.二分法找出磁盘占用空间最大的目录&lt;/h3&gt;&lt;p&gt;Win 7的应用程序缓存目录是在&lt;code&gt;C:\Users\jacpy\AppData&lt;/code&gt;目录中，&lt;code&gt;jacpy&lt;/code&gt;为当前系统用户名。&lt;code&gt;AppData&lt;/code&gt;为隐藏目录，要在目录菜单的“组织”中找到“文件夹和搜索选项”的弹出框的“查看”Tab页中修改，不会修改也没关系，打开一个目录，把上面的路径直接copy到路径框里面，把用户名换成自己的电脑用户名，回车就行了。&lt;/p&gt;
    
    </summary>
    
      <category term="android" scheme="http://www.jacpy.com/categories/android/"/>
    
    
      <category term="genymotion" scheme="http://www.jacpy.com/tags/genymotion/"/>
    
  </entry>
  
  <entry>
    <title>使用Gradle编译报错：Execution failed for task &#39;:packageAllDebugClassesForMultiDex&#39;  java.util.zip.ZipException duplicate entry解决方法</title>
    <link href="http://www.jacpy.com/2015/10/30/Error-Execution-failed-for-task-packageAllDebugClassesForMultiDex-duplicate-entry.html"/>
    <id>http://www.jacpy.com/2015/10/30/Error-Execution-failed-for-task-packageAllDebugClassesForMultiDex-duplicate-entry.html</id>
    <published>2015-10-30T04:42:40.000Z</published>
    <updated>2015-10-30T15:38:48.000Z</updated>
    
    <content type="html">&lt;p&gt;今天用Gradle编译Android项目时，报了一个错：&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Error:Execution failed &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; task &lt;span class=&quot;string&quot;&gt;&#39;:packageAllDebugClassesForMultiDex&#39;&lt;/span&gt;.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;gt; java.util.zip.ZipException: duplicate entry: com/taobao/tae/sdk/openim/OpenWXUiApiImpl$&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;$&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;.class&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;由于第一次遇到这种错，看提示信息以为是项目的方法数超过65535的限制，于是google一下，看别人有没有遇到这个问题。结果在&lt;code&gt;stackoverflow&lt;/code&gt;上好多人遇到这个问题，有人说是bug，有人说要求各种组合的jar包版本要一致，按上面说的修改方法在build.gradle配置文件中改了一下，编译后还是报这个错。&lt;/p&gt;
&lt;p&gt;这时心里开始犯嘀咕了，难道是新用的阿里的jar包方法数太多了？于是到libs目录看一下，这一看不要紧，发现问题了&lt;strong&gt;同一个jar包存在两个版本&lt;/strong&gt;，删除老的版本。重新编译，OK了。&lt;/p&gt;
&lt;p&gt;出现这样问题的原因是自己在Android Studio、Eclipse、SVN之间倒腾代码时没注意到jar包重复，出现重复包时Gradle编译出现的错误与Eclipse提示错误不一致。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;今天用Gradle编译Android项目时，报了一个错：&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Error:Execution failed &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; task &lt;span class=&quot;string&quot;&gt;&#39;:packageAllDebugClassesForMultiDex&#39;&lt;/span&gt;.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;gt; java.util.zip.ZipException: duplicate entry: com/taobao/tae/sdk/openim/OpenWXUiApiImpl$&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;$&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;.class&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="android" scheme="http://www.jacpy.com/categories/android/"/>
    
    
      <category term="packageAllDebugClassesForMultiDex" scheme="http://www.jacpy.com/tags/packageAllDebugClassesForMultiDex/"/>
    
  </entry>
  
  <entry>
    <title>使用BaseAdapter的getItemViewType()报错解决方案</title>
    <link href="http://www.jacpy.com/2015/10/22/android-BaseAdapter-getItemViewType-must-be-in-the-range-0-to-getViewTypeCount-1.html"/>
    <id>http://www.jacpy.com/2015/10/22/android-BaseAdapter-getItemViewType-must-be-in-the-range-0-to-getViewTypeCount-1.html</id>
    <published>2015-10-22T13:13:40.000Z</published>
    <updated>2015-10-30T15:55:46.000Z</updated>
    
    <content type="html">&lt;p&gt;前几天开发一个类似微信搜索显示搜索结果分类展示的功能，很自然的联想到了使用ListView去展示最后搜索的结果。每个分类最前面要显示一个分类的标题，就想使用&lt;code&gt;getItemViewType()&lt;/code&gt;、&lt;code&gt;getViewTypeCount()&lt;/code&gt;这两个方法做展示效果，结果在搜索过滤条件刷新Adapter的列表时，发生了以下错误：&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;31&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;32&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;33&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;34&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;35&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;36&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;37&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;38&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;39&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;40&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;java.lang.ArrayIndexOutOfBoundsException: length=&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;; index=&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;at android.widget.AbsListView$RecycleBin.addScrapView(AbsListView.java:&lt;span class=&quot;number&quot;&gt;6355&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;at android.widget.ListView.layoutChildren(ListView.java:&lt;span class=&quot;number&quot;&gt;1565&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;at android.widget.AbsListView.onLayout(AbsListView.java:&lt;span class=&quot;number&quot;&gt;1994&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;at android.view.View.layout(View.java:&lt;span class=&quot;number&quot;&gt;14008&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;at android.view.ViewGroup.layout(ViewGroup.java:&lt;span class=&quot;number&quot;&gt;4373&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;at android.widget.LinearLayout.setChildFrame(LinearLayout.java:&lt;span class=&quot;number&quot;&gt;1663&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;at android.widget.LinearLayout.layoutVertical(LinearLayout.java:&lt;span class=&quot;number&quot;&gt;1521&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;at android.widget.LinearLayout.onLayout(LinearLayout.java:&lt;span class=&quot;number&quot;&gt;1434&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;at android.view.View.layout(View.java:&lt;span class=&quot;number&quot;&gt;14008&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;at android.view.ViewGroup.layout(ViewGroup.java:&lt;span class=&quot;number&quot;&gt;4373&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;at android.widget.FrameLayout.onLayout(FrameLayout.java:&lt;span class=&quot;number&quot;&gt;448&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;at android.view.View.layout(View.java:&lt;span class=&quot;number&quot;&gt;14008&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;at android.view.ViewGroup.layout(ViewGroup.java:&lt;span class=&quot;number&quot;&gt;4373&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;at android.widget.LinearLayout.setChildFrame(LinearLayout.java:&lt;span class=&quot;number&quot;&gt;1663&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;at android.widget.LinearLayout.layoutVertical(LinearLayout.java:&lt;span class=&quot;number&quot;&gt;1521&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;at android.widget.LinearLayout.onLayout(LinearLayout.java:&lt;span class=&quot;number&quot;&gt;1434&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;at android.view.View.layout(View.java:&lt;span class=&quot;number&quot;&gt;14008&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;at android.view.ViewGroup.layout(ViewGroup.java:&lt;span class=&quot;number&quot;&gt;4373&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;at android.widget.FrameLayout.onLayout(FrameLayout.java:&lt;span class=&quot;number&quot;&gt;448&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;at android.view.View.layout(View.java:&lt;span class=&quot;number&quot;&gt;14008&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;at android.view.ViewGroup.layout(ViewGroup.java:&lt;span class=&quot;number&quot;&gt;4373&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;at android.view.ViewRootImpl.performLayout(ViewRootImpl.java:&lt;span class=&quot;number&quot;&gt;1892&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;at android.view.ViewRootImpl.performTraversals(ViewRootImpl.java:&lt;span class=&quot;number&quot;&gt;1711&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;at android.view.ViewRootImpl.doTraversal(ViewRootImpl.java:&lt;span class=&quot;number&quot;&gt;989&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;at android.view.ViewRootImpl$TraversalRunnable.run(ViewRootImpl.java:&lt;span class=&quot;number&quot;&gt;4351&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;at android.view.Choreographer$CallbackRecord.run(Choreographer.java:&lt;span class=&quot;number&quot;&gt;749&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;at android.view.Choreographer.doCallbacks(Choreographer.java:&lt;span class=&quot;number&quot;&gt;562&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;at android.view.Choreographer.doFrame(Choreographer.java:&lt;span class=&quot;number&quot;&gt;532&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;at android.view.Choreographer$FrameDisplayEventReceiver.run(Choreographer.java:&lt;span class=&quot;number&quot;&gt;735&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;at android.os.Handler.handleCallback(Handler.java:&lt;span class=&quot;number&quot;&gt;725&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;at android.os.Handler.dispatchMessage(Handler.java:&lt;span class=&quot;number&quot;&gt;92&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;at android.os.Looper.loop(Looper.java:&lt;span class=&quot;number&quot;&gt;137&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;at android.app.ActivityThread.main(ActivityThread.java:&lt;span class=&quot;number&quot;&gt;5041&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;at java.lang.reflect.Method.invokeNative(Native Method)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;at java.lang.reflect.Method.invoke(Method.java:&lt;span class=&quot;number&quot;&gt;511&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:&lt;span class=&quot;number&quot;&gt;793&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:&lt;span class=&quot;number&quot;&gt;560&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;at dalvik.system.NativeStart.main(Native Method)&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;这个错误是系统内容代码报错，感觉原因就出在这两个方法上，因为没有加这两个方法，列表展示刷新OK。&lt;br&gt;最后通过查找官方文档说明发现，&lt;strong&gt;&lt;code&gt;getItemViewType()&lt;/code&gt;方法返回的值必须在0 ~ &lt;code&gt;getViewTypeCount()&lt;/code&gt; - 1&lt;/strong&gt;这个范围内。记录一个这个问题。下面是文档说明：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;public int getItemViewType (int position)&lt;/p&gt;
&lt;p&gt;Get the type of View that will be created by getView(int, View, ViewGroup) for the specified item.&lt;br&gt;Parameters&lt;br&gt;position    The position of the item within the adapter’s data set whose view type we want.&lt;br&gt;Returns&lt;br&gt;An integer representing the type of View. Two views should share the same type if one can be converted to the other in getView(int, View, ViewGroup). &lt;strong&gt;Note: Integers must be in the range 0 to getViewTypeCount() - 1&lt;/strong&gt;. IGNORE_ITEM_VIEW_TYPE can also be returned.&lt;/p&gt;
&lt;/blockquote&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;前几天开发一个类似微信搜索显示搜索结果分类展示的功能，很自然的联想到了使用ListView去展示最后搜索的结果。每个分类最前面要显示一个分类的标题，就想使用&lt;code&gt;getItemViewType()&lt;/code&gt;、&lt;code&gt;getViewTypeCount()&lt;/code&gt;这两个方法做展示效果，结果在搜索过滤条件刷新Adapter的列表时，发生了以下错误：&lt;/p&gt;
    
    </summary>
    
      <category term="android" scheme="http://www.jacpy.com/categories/android/"/>
    
    
      <category term="getItemViewType" scheme="http://www.jacpy.com/tags/getItemViewType/"/>
    
      <category term="getViewTypeCount" scheme="http://www.jacpy.com/tags/getViewTypeCount/"/>
    
  </entry>
  
  <entry>
    <title>hexo-deploy-No-such-device-or-address</title>
    <link href="http://www.jacpy.com/2015/10/08/hexo-deploy-No-such-device-or-address.html"/>
    <id>http://www.jacpy.com/2015/10/08/hexo-deploy-No-such-device-or-address.html</id>
    <published>2015-10-08T13:32:00.000Z</published>
    <updated>2015-10-30T15:39:00.000Z</updated>
    
    <content type="html">&lt;p&gt;前几天给博客增加评论功能，测试OK后准备将生成的文件提交到github，执行&lt;code&gt;hexo deploy&lt;/code&gt;命令时报如下错：&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;bash: /dev/tty: No such device or address&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;error: &lt;span class=&quot;function&quot;&gt;failed to execute prompt &lt;span class=&quot;title&quot;&gt;script&lt;/span&gt; &lt;span class=&quot;params&quot;&gt;(exit code &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;fatal: could not read Username &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; &#39;https:&lt;span class=&quot;comment&quot;&gt;//jacpy.github.com&#39;: No error&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;查看了一下LOG，HTML文件生成OK，然后错误就出现了，再试了一次，还是出错这个错误。回想之前提交文件时如果没出错应该是提示输入用户名和密码，突然想起前几天升级了git到2.5.3，是不是版本不兼容？创建这个博客时使用的git的版本是1.9.5，于是打算装回老版本，排查一下问题。&lt;/p&gt;
&lt;p&gt;等装了老版本重新提交时，发现OK了。果真是版本的问题？猜测出现问题的原因是git版本兼容性，但具体没有深究。&lt;/p&gt;
&lt;p&gt;通过以上遇到以上问题得到的教训是不要追求新版本，能满足需求即可，切记，切记。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;前几天给博客增加评论功能，测试OK后准备将生成的文件提交到github，执行&lt;code&gt;hexo deploy&lt;/code&gt;命令时报如下错：&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;bash: /dev/tty: No such device or address&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;error: &lt;span class=&quot;function&quot;&gt;failed to execute prompt &lt;span class=&quot;title&quot;&gt;script&lt;/span&gt; &lt;span class=&quot;params&quot;&gt;(exit code &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;fatal: could not read Username &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; &#39;https:&lt;span class=&quot;comment&quot;&gt;//jacpy.github.com&#39;: No error&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="No such device or address" scheme="http://www.jacpy.com/tags/No-such-device-or-address/"/>
    
  </entry>
  
  <entry>
    <title>使用hexo在github上搭建自己的博客</title>
    <link href="http://www.jacpy.com/2015/08/29/blog-width-hexo-in-github.html"/>
    <id>http://www.jacpy.com/2015/08/29/blog-width-hexo-in-github.html</id>
    <published>2015-08-29T10:43:50.000Z</published>
    <updated>2015-10-30T15:35:56.000Z</updated>
    
    <content type="html">&lt;p&gt;本文主要是介绍自己在github上搭建blog，把自己在wordpress中的博客迁移过来的过程，以及这过程中遇到的坑。&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h2 id=&quot;github上建站&quot;&gt;&lt;a href=&quot;#github上建站&quot; class=&quot;headerlink&quot; title=&quot;github上建站&quot;&gt;&lt;/a&gt;github上建站&lt;/h2&gt;&lt;h3 id=&quot;1-注册账号&quot;&gt;&lt;a href=&quot;#1-注册账号&quot; class=&quot;headerlink&quot; title=&quot;1.注册账号&quot;&gt;&lt;/a&gt;1.注册账号&lt;/h3&gt;&lt;p&gt;在&lt;a href=&quot;https://github.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;github&lt;/a&gt;上注册账号过程就不详说了，没啥难度。&lt;/p&gt;
&lt;h3 id=&quot;2-创建仓库&quot;&gt;&lt;a href=&quot;#2-创建仓库&quot; class=&quot;headerlink&quot; title=&quot;2.创建仓库&quot;&gt;&lt;/a&gt;2.创建仓库&lt;/h3&gt;&lt;p&gt;注册在完成后登录，在自己的首页，即&lt;a href=&quot;https://github.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com&lt;/a&gt;  页面的右下角会有一个&lt;strong&gt;You repositories&lt;/strong&gt;栏，点击右边绿色的&lt;strong&gt;New respository&lt;/strong&gt;按钮，创建一个&lt;strong&gt;Repository name&lt;/strong&gt;为与注册账户名称相同的并且带上&lt;strong&gt;.github.io&lt;/strong&gt;后缀，如jacpy.github.io（将jacpy替换成你自己注册的名称，下同 ），注意这里是&lt;strong&gt;github.io&lt;/strong&gt;不是&lt;strong&gt;github.com&lt;/strong&gt;，点击创建repository页面的底部点击&lt;strong&gt;Create repository&lt;/strong&gt;按钮后会要你选择博客的模板和一些信息，整个过程完成后，就可以直接访问&lt;a href=&quot;https://jacpy.github.io&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://jacpy.github.io&lt;/a&gt; 了。&lt;br&gt;具体参考：&lt;a href=&quot;https://pages.github.com/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://pages.github.com/&lt;/a&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&quot;安装git&quot;&gt;&lt;a href=&quot;#安装git&quot; class=&quot;headerlink&quot; title=&quot;安装git&quot;&gt;&lt;/a&gt;安装git&lt;/h2&gt;&lt;p&gt;如果你PC上安装过git，此步略过；如果没安装，那么从&lt;a href=&quot;https://git-scm.com/downloads&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;git官网&lt;/a&gt;  上下载git安装，安装过程中要将git添加到PATH中，安装过程中有页面有这样的选项，钩上就行了。&lt;/p&gt;
&lt;h2 id=&quot;安装node-js&quot;&gt;&lt;a href=&quot;#安装node-js&quot; class=&quot;headerlink&quot; title=&quot;安装node.js&quot;&gt;&lt;/a&gt;安装node.js&lt;/h2&gt;&lt;p&gt;到&lt;a href=&quot;https://nodejs.org/download/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;node.js官网&lt;/a&gt; 下载一个安装，如果你是老版本了，建议升级成最新版本，我PC上安装的是最新的0.12.7版本，npm -v的版本是2.11.3。&lt;/p&gt;
&lt;h2 id=&quot;安装hexo&quot;&gt;&lt;a href=&quot;#安装hexo&quot; class=&quot;headerlink&quot; title=&quot;安装hexo&quot;&gt;&lt;/a&gt;安装hexo&lt;/h2&gt;&lt;h3 id=&quot;1-安装&quot;&gt;&lt;a href=&quot;#1-安装&quot; class=&quot;headerlink&quot; title=&quot;1.安装&quot;&gt;&lt;/a&gt;1.安装&lt;/h3&gt;&lt;p&gt;打开命令行，执行以下命令：&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;npm install -g hexo-cli&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;npm install hexo --save&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h3 id=&quot;2-配置&quot;&gt;&lt;a href=&quot;#2-配置&quot; class=&quot;headerlink&quot; title=&quot;2.配置&quot;&gt;&lt;/a&gt;2.配置&lt;/h3&gt;&lt;p&gt;先创建一个目录jacpy，再在命令行cd到这个目录，执行下面命令，执行初始化操作和安装一些插件：&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;hexo init&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;npm install hexo-generator-index --save&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;npm install hexo-generator-archive --save&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;npm install hexo-generator-category --save&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;npm install hexo-generator-tag --save&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;npm install hexo-server --save&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;npm install hexo-deployer-git --save&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;npm install hexo-deployer-heroku --save&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;npm install hexo-deployer-rsync --save&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;npm install hexo-deployer-openshift --save&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;npm install hexo-renderer-marked@&lt;span class=&quot;number&quot;&gt;0.2&lt;/span&gt; --save&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;npm install hexo-renderer-stylus@&lt;span class=&quot;number&quot;&gt;0.2&lt;/span&gt; --save&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;npm install hexo-generator-feed@&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt; --save&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;npm install hexo-generator-sitemap@&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt; --save&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;提示：把上面一大串命令直接复制到命令行，不用一条一条复制，再回车。&lt;br&gt;&lt;strong&gt;注意：&lt;/strong&gt;如果在执行命令过程中会有一些提示，比如提示要执行一些命令，那么就按要求直接执行，下同，不然就出现一些意想不到的情况。后面会有一个错误解决的例子。&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;3-本地效果查看&quot;&gt;&lt;a href=&quot;#3-本地效果查看&quot; class=&quot;headerlink&quot; title=&quot;3.本地效果查看&quot;&gt;&lt;/a&gt;3.本地效果查看&lt;/h3&gt;&lt;p&gt;环境已经准备好了，接下来就可以写一篇了博客了，执行创建命令：&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;hexo &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; blog-width-hexo-in-github&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;等待几秒，会在jacpy/source/_posts/创建一个blog-width-hexo-in-github.md文件。打开文件就可以编辑，使用的markdown语法。&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;话说这命令执行的速度太慢了吧，貌似整个一晚上的操作印象中，执行命令速度都很慢，都要等几秒钟，没有瞬间完成的，吐槽一下执行的速度。另外如果长时间发现命令没响应，就按ctrl + C终止命令，重新再执行一下，这个也是坑爹的地方。&lt;/li&gt;
&lt;li&gt;生成的md文件介绍可以参考&lt;a href=&quot;https://hexo.io/zh-cn/docs/writing.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;写作&lt;/a&gt; ， &lt;a href=&quot;https://hexo.io/zh-cn/docs/front-matter.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Front-matter&lt;/a&gt;。&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;清除和生成静态HTML文件，命令如下：&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;hexo clean&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;hexo generate&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;执行后，会在目录jacpy目录下创建一个public目录，里面是生成网页的全部内容，OK，启动服务预览一下：&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;hexo server&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;在浏览器中访问:localhost:4000，你可以看到正常的页面内容，如果出现以下不正常的页面：&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&amp;lt;%- partial(&lt;span class=&quot;string&quot;&gt;&#39;_partial/head&#39;&lt;/span&gt;) %&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;lt;%- partial(&lt;span class=&quot;string&quot;&gt;&#39;_partial/header&#39;&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;, &amp;#123;cache: !config.relative_link&amp;#125;) %&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;lt;%- body %&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;lt;% &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (theme.sidebar &amp;amp;&amp;amp; theme.sidebar !== &lt;span class=&quot;string&quot;&gt;&#39;bottom&#39;&lt;/span&gt;)&amp;#123; %&amp;gt; &amp;lt;%- partial(&lt;span class=&quot;string&quot;&gt;&#39;_partial/sidebar&#39;&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;,     &amp;#123;cache: !config.relative_link&amp;#125;) %&amp;gt; &amp;lt;% &amp;#125; %&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;lt;%- partial(&lt;span class=&quot;string&quot;&gt;&#39;_partial/footer&#39;&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;, &amp;#123;cache: !config.relative_link&amp;#125;) %&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;lt;%- partial(&lt;span class=&quot;string&quot;&gt;&#39;_partial/mobile-nav&#39;&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;, &amp;#123;cache: !config.relative_link&amp;#125;) %&amp;gt; &amp;lt;%- partial(&lt;span class=&quot;string&quot;&gt;&#39;_partial/after-footer&#39;&lt;/span&gt;) %&amp;gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;在命令行执行：&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;npm install&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;再生成执行清除和生成HTML命令即OK。因为在执行上面命令后，会有提示要执行npm install命令，但自己忽略了，才导致这个问题。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&quot;导出wordpress博客&quot;&gt;&lt;a href=&quot;#导出wordpress博客&quot; class=&quot;headerlink&quot; title=&quot;导出wordpress博客&quot;&gt;&lt;/a&gt;导出wordpress博客&lt;/h2&gt;&lt;p&gt;导出wordpress博客可参考&lt;a href=&quot;https://hexo.io/zh-cn/docs/migration.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;hexo官方说明&lt;/a&gt;。&lt;br&gt;导出来的是一个xml文件，转换完成后，在命令行cd到public目录，先删除public目录中的内容，再执行初始化命令：&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;git init&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;git remote add origin https:&lt;span class=&quot;comment&quot;&gt;//github.com/jacpy/jacpy.github.io.git&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;git pull origin master&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;注意：&lt;/strong&gt;是master分支，不是gh-pages分支。后面的内容都是在master分支上操作。&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;OK，删除public中所有的内容，除了.git目录。然后执行：&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;git add -A&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;git commit -m &lt;span class=&quot;string&quot;&gt;&quot;remove default pages&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;git push origin master&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;按提示输入用户名和密码。上面的操作是将github上面的页面文件先删除，也可以在github上面打开文件，点击文件右上角的垃圾箱按钮，一个一个的删除。&lt;br&gt;再回到jacpy目录，执行清除和生成HTML命令，最后使用上面的命令将publish的内容提交到github上面，再刷新一下你的jacpy.github.io主页，内容已经更新上去。&lt;br&gt;到这一步已经大功了。当然你可以使用hexo deploy命令，将内容提交到github，需要配置jacpy目录下的_config.yml文件，在末尾找到deploy项，进行编辑：&lt;br&gt;&lt;figure class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;# Deployment&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;## Docs: http://hexo.io/docs/deployment.html&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;deploy:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  type: git&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  repo: https://github.com/jacpy/jacpy.github.io.git&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  branch: master&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&quot;修改域名解析&quot;&gt;&lt;a href=&quot;#修改域名解析&quot; class=&quot;headerlink&quot; title=&quot;修改域名解析&quot;&gt;&lt;/a&gt;修改域名解析&lt;/h2&gt;&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;这部分是自己耗时最多的地方，中间还遇到404问题，卡了很久。如果你自己有一个域名，想直接通过域名访问你的github上面的博客，形如访问jacpy.com时，会自动跳转到jacpy.github.io页面，但地址栏并没有改变，那么接着往下看。&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;因为自己的域名是在万网上注册的，所以到万网上修改配置。为了避免做广告之嫌，推荐一下&lt;a href=&quot;https://www.godaddy.com/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;godady&lt;/a&gt; 可以对比一下性价比。万网现在已经被阿里收购了，所以网页风格都和阿里云保持一致了，访问[域名列表页面(&lt;a href=&quot;http://netcn.console.aliyun.com/core/domain/tclist&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://netcn.console.aliyun.com/core/domain/tclist&lt;/a&gt;) ，点击自己的域名会跳转到另外一个页面，我原来是将这个域名绑定到一个IP地址，所以看到的&lt;strong&gt;记录类型&lt;/strong&gt;是&lt;strong&gt;A&lt;/strong&gt;，点击右边的修改栏，将记录类型修改成&lt;strong&gt;CNAME&lt;/strong&gt;，如下图所示：&lt;br&gt;&lt;img src=&quot;https://github.com/jacpy/jacpy.github.io/raw/master/images/2015/08/29/domain_list.jpg&quot; alt=&quot;域名列表截图&quot;&gt;&lt;/p&gt;
&lt;p&gt;保存以后，如果现在访问你的域名jacpy.com，肯定会出现404，因为还要在master分支上创建一个CNAME文件。&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;出现404有两个原因，一个是你访问的是&lt;strong&gt;jacpy.github.com&lt;/strong&gt;而不是&lt;strong&gt;jacpy.github.io&lt;/strong&gt;，另外一个就是在master分支上没有CNAME文件。&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;OK，在jacpy/source目录中创建一个CNAME文件，在里面在增加一行内容：&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;jacpy.com&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;然后再重新生成HTML命令和提交到github。OK，到此已经全部完成了：)。&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;如果发现HTML中有乱码，将md文件转换成UTF-8编码即可。&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;参考：&lt;br&gt;&lt;a href=&quot;http://wsgzao.github.io/post/hexo-guide/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://wsgzao.github.io/post/hexo-guide/&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://linux.cn/article-5930-qqmail.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://linux.cn/article-5930-qqmail.html&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://help.github.com/categories/github-pages-basics/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://help.github.com/categories/github-pages-basics/&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://hexo.io/zh-cn/docs/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://hexo.io/zh-cn/docs/&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;本文主要是介绍自己在github上搭建blog，把自己在wordpress中的博客迁移过来的过程，以及这过程中遇到的坑。&lt;/p&gt;
    
    </summary>
    
      <category term="github" scheme="http://www.jacpy.com/categories/github/"/>
    
    
      <category term="github hex blog" scheme="http://www.jacpy.com/tags/github-hex-blog/"/>
    
  </entry>
  
  <entry>
    <title>android SQLite性能优化（二）——使用NDK优化</title>
    <link href="http://www.jacpy.com/2015/06/24/android-sqlite-performance-optimization-used-ndk.html"/>
    <id>http://www.jacpy.com/2015/06/24/android-sqlite-performance-optimization-used-ndk.html</id>
    <published>2015-06-23T19:56:18.000Z</published>
    <updated>2016-03-12T08:06:14.000Z</updated>
    
    <content type="html">&lt;p&gt;在做android SQLite数据插入性能优化时，前面一篇&lt;a href=&quot;http://www.jacpy.com/?p=47&quot;&gt;android SQLite性能优化（一）——使用事务和预处理&lt;/a&gt;提到了使用事务和预处理做优化，本篇介绍使用NDK的方式进行数据插入优化。&lt;br&gt;使用NDK操作数据库时，需要使用sqlite的官方源码，我这里测试使用的是官方的3.8.7.4版本的代码。同样在使用sqlite操作数据库时使用了事务和预处理。&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;下面是Java层的代码，主要是将List数据转换成数组数据，指定数据库文件路径，及数组数据和长度。&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;insertNative&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(List&amp;lt;DemoItem&amp;gt; data)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    Log.d(TAG, &lt;span class=&quot;string&quot;&gt;&quot;databases path: &quot;&lt;/span&gt; + getCacheDir());&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; size = data.size();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    DemoItem[] items = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; DemoItem[size];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    data.toArray(items);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    File file = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; File(getCacheDir(), &lt;span class=&quot;string&quot;&gt;&quot;tel.db&quot;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt; start = System.currentTimeMillis();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    TelTools.insertNative(file.getAbsolutePath(), items, items.length);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt; end = System.currentTimeMillis();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    Log.d(TAG, &lt;span class=&quot;string&quot;&gt;&quot;used time: &quot;&lt;/span&gt; + (end - start) + &lt;span class=&quot;string&quot;&gt;&quot;, nums: &quot;&lt;/span&gt; + items.length + &lt;span class=&quot;string&quot;&gt;&quot;, average item: &quot;&lt;/span&gt; + (end - start) / items.length);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// 使用预处理&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// used time: 2372, nums: 65536, average item: 0&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// used time: 2422, nums: 65536, average item: 0&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt; 整个耗时2.4秒左右，是使用Java的方式耗时的一半都不到。下面是C代码，可以看出来，使用C代码操作数据库需要做很多事情，远没有Java来的方便；如果数据库结构发生修改，就更难维护了。&lt;br&gt;&lt;figure class=&quot;highlight cpp&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;31&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;32&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;33&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;34&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;35&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;36&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;37&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;38&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;39&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;40&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;41&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;42&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;43&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;44&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;45&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;46&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;47&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;48&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;49&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;50&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;51&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;52&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;53&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;54&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;55&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;56&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;57&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;58&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;59&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;60&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;61&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;62&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;63&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;64&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;65&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;66&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;67&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;68&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;69&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;70&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;71&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;72&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;73&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;74&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;75&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;76&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;77&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;78&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;79&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;80&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;81&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;82&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;83&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;84&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;85&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;86&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;87&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;88&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;89&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;90&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;91&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;92&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;93&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;94&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;95&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;96&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;97&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;98&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;99&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;100&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;101&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;102&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;103&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;104&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;105&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;106&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;107&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;108&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;109&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;110&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;111&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;112&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;113&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;114&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;115&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;116&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;117&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;118&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;119&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;120&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;JNIEXPORT jint JNICALL &lt;span class=&quot;title&quot;&gt;Java_com_example_sqlitedemo_TelTools_insertNative&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;params&quot;&gt;(JNIEnv *env, jclass jcls, jstring jdbPath, jobjectArray jarr, jint jlen)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (jlen &amp;lt;= &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        LOGW(&lt;span class=&quot;string&quot;&gt;&quot;len must &amp;gt; 0&quot;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt;* sdbPath = (*env)-&amp;gt;GetStringUTFChars(env, jdbPath, &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    sqlite3* db;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; result = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    sqlite3_initialize( );&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    result = sqlite3_open_v2(sdbPath, &amp;amp;db, SQLITE_OPEN_READWRITE|SQLITE_OPEN_CREATE, &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (SQLITE_OK != result) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        LOGE(&lt;span class=&quot;string&quot;&gt;&quot;sqlite3_open failed, result: %d, error msg: %s&quot;&lt;/span&gt;, result, sqlite3_errmsg(db));&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; result;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt;* createSQL = &lt;span class=&quot;string&quot;&gt;&quot;CREATE TABLE tel(_id INTEGER PRIMARY KEY, id TEXT, tel TEXT, code TEXT, address TEXT, type TEXT, date INTEGER)&quot;&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt;* pErrorMsg;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    result = sqlite3_exec(db, createSQL, &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;, &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;, &amp;amp;pErrorMsg);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (SQLITE_ERROR != result &amp;amp;&amp;amp; SQLITE_OK != result) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        LOGE(&lt;span class=&quot;string&quot;&gt;&quot;exec sql(%s) failed, result: %d, error msg: %s&quot;&lt;/span&gt;, createSQL, result, pErrorMsg);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        sqlite3_free(pErrorMsg);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        sqlite3_close(db);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; result;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    jclass cItem = (*env)-&amp;gt;FindClass(env, &lt;span class=&quot;string&quot;&gt;&quot;com/example/sqlitedemo/mode/DemoItem&quot;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    jfieldID fID = (*env)-&amp;gt;GetFieldID(env, cItem, &lt;span class=&quot;string&quot;&gt;&quot;id&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;Ljava/lang/String;&quot;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    jfieldID fTel = (*env)-&amp;gt;GetFieldID(env, cItem, &lt;span class=&quot;string&quot;&gt;&quot;tel&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;Ljava/lang/String;&quot;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    jfieldID fCode = (*env)-&amp;gt;GetFieldID(env, cItem, &lt;span class=&quot;string&quot;&gt;&quot;code&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;Ljava/lang/String;&quot;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    jfieldID fAddress = (*env)-&amp;gt;GetFieldID(env, cItem, &lt;span class=&quot;string&quot;&gt;&quot;address&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;Ljava/lang/String;&quot;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    jfieldID fType = (*env)-&amp;gt;GetFieldID(env, cItem, &lt;span class=&quot;string&quot;&gt;&quot;type&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;Ljava/lang/String;&quot;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    jfieldID fDate = (*env)-&amp;gt;GetFieldID(env, cItem, &lt;span class=&quot;string&quot;&gt;&quot;date&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;J&quot;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;//const int sqlLen = 512;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;//char sql[sqlLen];&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt;* insertSQL = &lt;span class=&quot;string&quot;&gt;&quot;insert into tel(id, tel, code, address, type, date) values(?,?,?,?,?,?)&quot;&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt;* beginSQL = &lt;span class=&quot;string&quot;&gt;&quot;begin;&quot;&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt;* commitSQL = &lt;span class=&quot;string&quot;&gt;&quot;commit;&quot;&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt;* rollbackSQL = &lt;span class=&quot;string&quot;&gt;&quot;rollback;&quot;&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    sqlite3_exec(db, beginSQL, &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;, &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;, &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;//string sql;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; isSuccess = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    jobject obj;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    jstring sId, sTel, sCode, sAddress, sType;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    sqlite3_stmt *stmt = &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    sqlite3_prepare_v2(db, insertSQL, &lt;span class=&quot;built_in&quot;&gt;strlen&lt;/span&gt;(insertSQL) * &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;, &amp;amp;stmt, &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; i;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (i = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i &amp;lt; jlen; i++) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        obj = (*env)-&amp;gt;GetObjectArrayElement(env, jarr, i);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        sId = (jstring) ((*env)-&amp;gt;GetObjectField(env, obj, fID));&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt;* id = (*env)-&amp;gt;GetStringUTFChars(env, sId, &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        sTel = (jstring) ((*env)-&amp;gt;GetObjectField(env, obj, fTel));&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt;* tel = (*env)-&amp;gt;GetStringUTFChars(env, sTel, &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        sCode = (jstring) ((*env)-&amp;gt;GetObjectField(env, obj, fCode));&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt;* code = (*env)-&amp;gt;GetStringUTFChars(env, sCode, &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        sAddress = (jstring) ((*env)-&amp;gt;GetObjectField(env, obj, fAddress));&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt;* address = (*env)-&amp;gt;GetStringUTFChars(env, sAddress, &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        sType = (jstring) ((*env)-&amp;gt;GetObjectField(env, obj, fType));&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt;* type = (*env)-&amp;gt;GetStringUTFChars(env, sType, &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        (*env)-&amp;gt;DeleteLocalRef(env, obj);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;//jstring sDate = (jstring) (env-&amp;gt;GetObjectField(obj, fTel));&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;//const char* tel = env-&amp;gt;GetStringUTFChars(sTel, NULL);&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        sqlite3_bind_text(stmt, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, id, &lt;span class=&quot;built_in&quot;&gt;strlen&lt;/span&gt;(id), &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        sqlite3_bind_text(stmt, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, tel, &lt;span class=&quot;built_in&quot;&gt;strlen&lt;/span&gt;(tel), &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        sqlite3_bind_text(stmt, &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;, code, &lt;span class=&quot;built_in&quot;&gt;strlen&lt;/span&gt;(code), &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        sqlite3_bind_text(stmt, &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;, address, &lt;span class=&quot;built_in&quot;&gt;strlen&lt;/span&gt;(address), &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        sqlite3_bind_text(stmt, &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;, type, &lt;span class=&quot;built_in&quot;&gt;strlen&lt;/span&gt;(type), &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        sqlite3_bind_text(stmt, &lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;10000000&quot;&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;8&lt;/span&gt;, &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        sqlite3_step(stmt);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        sqlite3_reset(stmt);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        sqlite3_clear_bindings(stmt);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;//LOGD(&quot;sql: %s&quot;, sql.c_str());&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;//result = sqlite3_exec(db, sql, NULL, NULL, &amp;amp;pErrorMsg);&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;//sql.clear();&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        (*env)-&amp;gt;ReleaseStringUTFChars(env, sId, id);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        (*env)-&amp;gt;ReleaseStringUTFChars(env, sTel, tel);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        (*env)-&amp;gt;ReleaseStringUTFChars(env, sCode, code);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        (*env)-&amp;gt;ReleaseStringUTFChars(env, sAddress, address);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        (*env)-&amp;gt;ReleaseStringUTFChars(env, sType, type);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        (*env)-&amp;gt;DeleteLocalRef(env, sId);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        (*env)-&amp;gt;DeleteLocalRef(env, sTel);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        (*env)-&amp;gt;DeleteLocalRef(env, sCode);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        (*env)-&amp;gt;DeleteLocalRef(env, sAddress);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        (*env)-&amp;gt;DeleteLocalRef(env, sType);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//        isSuccess = result == 0;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//        if (!isSuccess) &amp;#123;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//            break;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//        &amp;#125;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (isSuccess) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        sqlite3_exec(db, commitSQL, &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;, &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;, &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        sqlite3_exec(db, rollbackSQL, &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;, &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;, &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    (*env)-&amp;gt;ReleaseStringUTFChars(env, jdbPath, sdbPath);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    (*env)-&amp;gt;DeleteLocalRef(env, jdbPath);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    sqlite3_free(pErrorMsg);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    sqlite3_finalize(stmt);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    sqlite3_close(db);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    sqlite3_shutdown();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; result;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;So，到这一步就没能再进行优化下去了，上面测试的表结构没有加索引，加了会影响性能，但可以提高查询效率。其中要注意语言细节性能问题，因为循环有几万次，所以很小的细节都会被放大。网上还有论文优化了sqlite的查询性能，单次性能提升了10%，目测是修改了sqlite中虚拟机产生代码的处理流程，恕水平有限，没有耗更多的精力和时间在这上面，到此就结束了，如果读者感兴趣，可以接着优化。google搜索关键字《SQLite的SQL语句高速缓存技术》即可找到这篇论文。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;在做android SQLite数据插入性能优化时，前面一篇&lt;a href=&quot;http://www.jacpy.com/?p=47&quot;&gt;android SQLite性能优化（一）——使用事务和预处理&lt;/a&gt;提到了使用事务和预处理做优化，本篇介绍使用NDK的方式进行数据插入优化。&lt;br&gt;使用NDK操作数据库时，需要使用sqlite的官方源码，我这里测试使用的是官方的3.8.7.4版本的代码。同样在使用sqlite操作数据库时使用了事务和预处理。&lt;/p&gt;
    
    </summary>
    
      <category term="sqlite" scheme="http://www.jacpy.com/categories/sqlite/"/>
    
    
      <category term="SQLite性能优化" scheme="http://www.jacpy.com/tags/SQLite%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>android SQLite性能优化（一）——使用事务和预处理</title>
    <link href="http://www.jacpy.com/2015/06/24/android-sqlite-performance-optimization-used-transaction-and-sql-compile.html"/>
    <id>http://www.jacpy.com/2015/06/24/android-sqlite-performance-optimization-used-transaction-and-sql-compile.html</id>
    <published>2015-06-23T19:44:11.000Z</published>
    <updated>2016-03-12T08:06:51.000Z</updated>
    
    <content type="html">&lt;p&gt;老大交给了一个任务，其他项目组在应用初始化时，需要从服务器下载通讯录，然后插入到本地数据，由于数据量比较大，整个插入过程非常耗时，看我能不能优化一下。于是就有了下文。&lt;/p&gt;
&lt;p&gt;SQL执行性能影响从根本原因上不外乎以下几种情况：&lt;/p&gt;
&lt;p&gt;1.CPU执行时间；&lt;/p&gt;
&lt;p&gt;2.存储器读写时间；&lt;/p&gt;
&lt;p&gt;3.网络传输消耗。&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;第1点针对CPU可以做的优化有使用预处理，防止CPU多次解析SQL语句；第2点针对存储器读写时间的优化有使用事务，将数据写全部写入到内容，然后一次性写入到本地存储空间，当然这需要足够的内存空间，否则会导致内存溢出，这个问题在android开发尤其重要，不然App会退出运行。第3点在android开发中基本用不到，所以只针对前面两点考虑优化。&lt;/p&gt;
&lt;p&gt;下面是优化的案例，数据是从网上下载的号码归属地XLS数据，总共65535行数据，老大说通讯录的数据也有几万条，正好可以用这个数据做测试，只不过XLS数据每行数据差别不大，很有规律，通过跟真实数据测试发现，差别不大。&lt;/p&gt;
&lt;p&gt;按照上面的思路，基本告别android.content.ContentValues类，得自己拼接SQL，再使用SQLiteDatabse.execSQL()执行预处理。&lt;/p&gt;
&lt;p&gt;下面代码是表结构（没有从代码中整理成表格，大概能知道有几个字段及字段的类型）：&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;db.execSQL(“CREATE TABLE “ + TelColumns.TABLE_NAME + “ (“&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    + TelColumns._ID + “ INTEGER PRIMARY KEY,“&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    + TelColumns.ID + “ TEXT,“&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    + TelColumns.TEL + “ TEXT,“&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    + TelColumns.CODE + “ TEXT,“&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    + TelColumns.ADDRESS + “ TEXT,“&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    + TelColumns.TYPE + “ TEXT,“&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    + TelColumns.DATE + “ INTEGER“&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    + “);“);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;TelColumns&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;BaseColumns&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; String TABLE_NAME = “tel“;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; String ID = “id“;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; String TEL = “tel“;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; String CODE = “code“;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; String TYPE = “name“;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; String ADDRESS = “depart“;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; String DATE = “date“;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;下面代码使用了事务和和预处理的SQL，data数据来源于对XLS数据的解析。在开始执行事务时开始记时，完成后关闭数据库记时结束。&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;31&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;32&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;33&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;34&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;35&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;36&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;37&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;38&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;39&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;40&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;41&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;42&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;43&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;44&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;45&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;46&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;47&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;insertByRaw&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(List&amp;amp;lt;DemoItem&amp;amp;gt; data)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; size = data.size();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; idx = size;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	TelDatabase db = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; TelDatabase(getApplicationContext());&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	SQLiteDatabase sqliteDB = db.getWritableDatabase();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt; start = System.currentTimeMillis();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	sqliteDB.beginTransaction(); &lt;span class=&quot;comment&quot;&gt;// 事务开始&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	DemoItem item = &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	StringBuilder sb = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; StringBuilder();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	sb.append(“INSERT INTO “).append(TelColumns.TABLE_NAME)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	.append(“(“)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	.append(TelColumns.ID).append(“,“)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	.append(TelColumns.TEL).append(“,“)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	.append(TelColumns.CODE).append(“,“)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	.append(TelColumns.ADDRESS).append(“,“)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	.append(TelColumns.TYPE).append(“,“)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	.append(TelColumns.DATE)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	.append(“)“)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	.append(“ VALUES(?,?,?,?,?,?)“); &lt;span class=&quot;comment&quot;&gt;// 预处理SQL&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	String sql = sb.toString();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	SQLiteStatement stmt = sqliteDB.compileStatement(sql);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i &amp;amp;lt; idx; i++) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;			item = data.get(i);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;			stmt.bindString(&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, item.id);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;			stmt.bindString(&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;, item.tel);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;			stmt.bindString(&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;, item.code);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;			stmt.bindString(&lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;, item.address);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;			stmt.bindString(&lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;, item.type);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;			stmt.bindLong(&lt;span class=&quot;number&quot;&gt;6&lt;/span&gt;, System.currentTimeMillis());&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;			stmt.execute();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		sqliteDB.setTransactionSuccessful();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	&amp;#125; &lt;span class=&quot;keyword&quot;&gt;finally&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		sqliteDB.endTransaction();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		stmt.close();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;long&lt;/span&gt; end = System.currentTimeMillis();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	sqliteDB.close();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	Log.d(TAG, “used time: “ + (end - start) + “, nums: “ + idx + “, average item: “ + (end - start) / size);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	&lt;span class=&quot;comment&quot;&gt;// used time: 5616, nums: 65536, average item: 0&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	&lt;span class=&quot;comment&quot;&gt;// used time: 5720, nums: 65536, average item: 0&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	&lt;span class=&quot;comment&quot;&gt;// used time: 5615, nums: 65536, average item: 0&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;上面代码在我的MOTO G XT1032手机上测试，耗时在5.6秒上下波动，上面注释的used time代码即为实际运行时间的随机值。数据插入完成后整个数据库文件有4.48M。&lt;/p&gt;
&lt;p&gt;后面用android.content.ContentValues类和SQLiteDatabase.insert()方法，同样加了事务测试了一下，运行耗时在17秒左右。很明显，慢了很多。&lt;/p&gt;
&lt;p&gt;So，测试到这儿任务结束了吗？前面的优化方法估计一般开发都能做到，那还有没有优化的空间？如果要体现自己的优势，那么就要寻找耗时更短的优化方式。后面还有性能提升的空间，请看下一篇&lt;a href=&quot;http://www.jacpy.com/?p=53&quot;&gt;android SQLite性能优化（二）——使用NDK优化&lt;/a&gt;。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;老大交给了一个任务，其他项目组在应用初始化时，需要从服务器下载通讯录，然后插入到本地数据，由于数据量比较大，整个插入过程非常耗时，看我能不能优化一下。于是就有了下文。&lt;/p&gt;
&lt;p&gt;SQL执行性能影响从根本原因上不外乎以下几种情况：&lt;/p&gt;
&lt;p&gt;1.CPU执行时间；&lt;/p&gt;
&lt;p&gt;2.存储器读写时间；&lt;/p&gt;
&lt;p&gt;3.网络传输消耗。&lt;/p&gt;
    
    </summary>
    
      <category term="sqlite" scheme="http://www.jacpy.com/categories/sqlite/"/>
    
    
      <category term="SQLite性能优化" scheme="http://www.jacpy.com/tags/SQLite%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>NDK编译时报错：make.exe: *** No rule to make target `jni/jni/apk_loader.cpp&#39;, needed by `obj/local/armeabi-v7a/objs/jni/apk_loader.o&#39;.  Stop.解决方法</title>
    <link href="http://www.jacpy.com/2015/06/05/ndk-compile-error-make-exe-no-rule-to-make-target-jnijniapk-loader-cpp-needed-by-objlocalarmeabi-v7aobjsjniapk-loader-o-stop-resolved.html"/>
    <id>http://www.jacpy.com/2015/06/05/ndk-compile-error-make-exe-no-rule-to-make-target-jnijniapk-loader-cpp-needed-by-objlocalarmeabi-v7aobjsjniapk-loader-o-stop-resolved.html</id>
    <published>2015-06-04T16:38:19.000Z</published>
    <updated>2015-10-30T15:47:54.000Z</updated>
    
    <content type="html">&lt;p&gt;在使用NDK编译代码时，如果出现如下错误：&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;make.exe: *** No rule to make target `jni/jni/apk_loader.cpp&lt;span class=&quot;string&quot;&gt;&#39;, needed by `obj/local/armeabi-v7a/objs/hook50/jni/apk_loader.o&#39;&lt;/span&gt;.  Stop.&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;很有可能是被编译的apk_loader.cpp在LOCAL_SRC_FILES变量中的路径有问题或者文件名不正确，仔细检查即可解决。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;在使用NDK编译代码时，如果出现如下错误：&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;make.exe: *** No rule to make target `jni/jni/apk_loader.cpp&lt;span class=&quot;string&quot;&gt;&#39;, needed by `obj/local/armeabi-v7a/objs/hook50/jni/apk_loader.o&#39;&lt;/span&gt;.  Stop.&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="ndk" scheme="http://www.jacpy.com/categories/ndk/"/>
    
    
  </entry>
  
</feed>
